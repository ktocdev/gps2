# GPS2 Sprint - December 31, 2025

**Started:** December 31, 2025
**Status:** Phase 4 - Interactions, Animation & Visual Polish
**Branch:** main
**Previous Sprint:** [SPRINT-2025-12-28.md](../phase3.5/archived/SPRINT-2025-12-28.md)

---

## Last Sprint Accomplishments (Dec 28-30)

- **Mobile Optimization** - Pinch-to-zoom, two-finger pan, safe area support, dynamic viewport height
- **New 3D Food Models** - Carrot stick, pellet pile, lettuce pile with food routing system
- **UI Color Contrast Fixes** - Green/cyan FAB colors, cyan color palette, activity log icon
- **Code Audit & Bug Fixes** - Index bounds, food selection reset, CSS logical properties, cleanup
- **Interaction Handler Refactoring** - Extracted petting/hand-feed to `use3DInteractions.ts` composable
- **Model Viewer Mobile** - Touch controls, mobile-first styles, UX fixes

---

## Critical Bugs & Blockers

None currently blocking. Medium priority bugs carried to backlog.

---

## High Priority Tasks

### 1. Code & CSS Audit
**Priority:** HIGH
**Status:** ‚úÖ Complete

**Goal:** Audit all code changes since last audit (Dec 28) for quality and consistency

**Files Audited (17 total):**

*Initial audit (Dec 30 changes):*
- `src/composables/3d-models/food/pellets.ts` ‚úÖ
- `src/composables/3d-models/food/greens.ts` ‚úÖ
- `src/composables/3d-models/food/vegetables.ts` ‚úÖ
- `src/composables/3d-models/containers/bowls.ts` ‚úÖ
- `src/components/debug/prototypes/ModelViewerDebug.vue` ‚úÖ
- `src/styles/game-fab.css` ‚úÖ
- `src/styles/variables.css` ‚úÖ

*Additional audit (Dec 28-30 missed files):*
- `src/composables/3d-models/food/held-food.ts` ‚úÖ
- `src/composables/3d/use3DInteractions.ts` ‚úÖ
- `src/composables/use3DCamera.ts` ‚úÖ
- `src/styles/game-view.css` ‚úÖ
- `src/components/game/SidePanel3D.vue` ‚úÖ
- `src/components/debug/environment/Habitat3DDebug.vue` ‚úÖ
- `src/components/game/GameView.vue` ‚úÖ
- `src/composables/3d-models/shelters/tunnels.ts` ‚úÖ
- `src/constants/3d.ts` ‚úÖ
- `src/types/supplies.ts` ‚úÖ

**Checklist Results:**
- [x] BEM naming convention
- [x] CSS logical properties (no physical margin/padding)
- [x] CSS variables usage
- [x] TypeScript strict types
- [x] THREE.js resource cleanup
- [x] No scoped styles
- [x] Consistent patterns

**Result:** All 17 files pass with no issues found.

---

### 2. Chat Bubbles
**Priority:** HIGH
**Status:** ‚úÖ Complete

**Goal:** Add guinea pig chat bubbles for reactions - parity with 2D game

**Implementation Approach:** HTML Overlay
- Chose HTML overlay approach for crisp text rendering
- Uses world-to-screen coordinate projection (`camera.project()`)
- Consistent with existing 3D UI patterns (menus, popovers)

**Files Created:**
- `src/composables/3d/use3DChatBubbles.ts` - Composable for bubble management
- `src/components/game/ChatBubble3D.vue` - Chat bubble component

**Files Modified:**
- `src/components/game/GameView.vue` - Integration with animation loop

**Tasks:**
- [x] Research best approach for 3D chat bubbles (HTML Overlay chosen)
- [x] Create `use3DChatBubbles.ts` composable
- [x] Create `ChatBubble3D.vue` component
- [x] Position above guinea pig head (Y offset + 3.5 units)
- [x] Trigger via `show-chat-bubble` event (same as 2D)
- [x] Add reaction text/emoji content
- [x] Auto-dismiss after duration (default 3 seconds)
- [x] Hide when guinea pig is behind camera

**Features:**
- One bubble per guinea pig at a time (new replaces old)
- 5 color variants: positive, neutral, negative, warning, critical
- Mobile-responsive sizing
- Reduced motion support
- Animated enter transition

**Chat Bubble Trigger Analysis:**

| Trigger Source | 2D Status | 3D Status | Notes |
|----------------|-----------|-----------|-------|
| **GP-to-GP Social** (`useSocialBehaviors.ts`) | ‚úÖ | ‚úÖ | Uses document events, works in both |
| **Autonomous Behaviors** (`useGuineaPigBehavior.ts`) | ‚úÖ | ‚úÖ | Uses document events, works in both |
| **Pet interaction** | ‚úÖ | ‚úÖ | Added to `use3DInteractions.ts` |
| **Hand-feed interaction** | ‚úÖ | ‚úÖ | Added to `use3DInteractions.ts` |
| **Hold interaction** | ‚úÖ | ‚ùå | Interaction not implemented in 3D yet |
| **Gentle Wipe interaction** | ‚úÖ | ‚ùå | Interaction not implemented in 3D yet |
| **Show Toy interaction** | ‚úÖ | ‚ùå | Interaction not implemented in 3D yet |
| **Peek-a-Boo interaction** | ‚úÖ | ‚ùå | Interaction not implemented in 3D yet |
| **Talk To interaction** | ‚úÖ | ‚ùå | Interaction not implemented in 3D yet |
| **Clean Cage care** | ‚úÖ | ‚úÖ | Added to `use3DHabitatCare.ts` |
| **Quick Clean care** | ‚úÖ | ‚úÖ | Added to `use3DHabitatCare.ts` |
| **Water Refill care** | ‚úÖ | ‚úÖ | Added to `use3DHabitatCare.ts` |
| **Hay Fill care** | ‚úÖ | ‚úÖ | Added to `HayManagementDialog.vue` |
| **Bowl Fill care** | ‚úÖ | ‚úÖ | Added to `use3DContainerMenu.ts` |

**Next Steps for Chat Bubbles:**
1. ~~Add chat bubble triggers to `use3DHabitatCare.ts` for care actions~~ ‚úÖ Complete
2. ~~Add bowl fill chat bubble~~ ‚úÖ Complete (via container menu)
3. Implement remaining 5 player-to-GP interactions with chat bubbles

---

### 3. Item Removal from Habitat
**Priority:** HIGH
**Status:** üìã Planned

**Goal:** Allow removing placed items (toys, balls, tunnels, shelters) from habitat back to inventory

**Implementation:**
- [ ] Add click/tap handler on placed items
- [ ] Show context menu with "Remove" option
- [ ] Call `habitatConditions.removeItemFromHabitat()`
- [ ] Call `inventoryStore.unmarkAsPlacedInHabitat()`
- [ ] Remove 3D model from scene
- [ ] Add activity log entry

**Notes:**
- 2D version only has removal for chew items (via hover popover)
- Backend already exists, just need UI trigger

---

### 4. Multiple Item Placement
**Priority:** HIGH
**Status:** üìã Planned

**Goal:** Support placing multiple instances of same item type in habitat

**Tasks:**
- [ ] Test current behavior with multiple food bowls
- [ ] Test with multiple water bottles
- [ ] Test with multiple toys
- [ ] Fix any issues with instance tracking
- [ ] Ensure each instance has unique position/state

---

## Medium Priority (Backlog)

### User-to-GP Interactions (5 Remaining)
**Status:** üöß In Progress (from previous sprint)

**Completed:**
- [x] Pet interaction
- [x] Hand Feed interaction

**Remaining:**
- [ ] **Hold** - Pick up guinea pig (+20-30% social, +2 friendship)
- [ ] **Gentle Wipe** - Cleaning (+40-50% cleanliness, +5% social, +1 friendship)
- [ ] **Show Toy** - Show toy to GP (+10-15% play, +5% social, +1 friendship)
- [ ] **Peek-a-Boo** - Playful interaction (+10% social, +1 friendship)
- [ ] **Talk To** - Voice interaction (+10-15% social, +1 friendship)

---

### GP-to-GP Social Interactions
**Goal:** Guinea pig seeks out another GP when social need is low

**Tasks:**
- [ ] Autonomous socializing behavior
- [ ] Approach animation
- [ ] Social interaction effects
- [ ] Player-initiated GP2GP actions

---

### Fix Guinea Pig Collisions
**Issue:** Guinea pigs walk through arch tunnel, igloo walls, water bottle

**Goal:** Proper collision detection/avoidance

---

### Replace Comfort Need with Stimulation
**Goal:** Replace comfort need with stimulation need (documented in docs folder)

---

## Low Priority (Backlog)

- Water bottle drinking animation
- Multiple item instances testing
- Mini progress bars in Habitat Care FABs
- Bedding items should look disabled in Inventory Panel
- Enhance groom animation
- Create fur patterns

---

## Sprint Completion Criteria

Before closing this sprint:
- [x] Code & CSS audit completed with fixes applied
- [x] Chat bubbles implemented and working
- [ ] Item removal from habitat working
- [ ] Multiple item placement tested and working
- [x] All changes documented in sprint doc
- [x] `npm run build` passes

---

## Commands

**Development:**
- `npm run dev` - Start development server
- `npm run build` - Production build (run before commits)
- `npm run preview` - Preview production build

**Git:**
- Current branch: `main`
- Main branch: `main`

---

## Reference Files

| Feature | Reference |
|---------|-----------|
| 3D Interactions | `src/composables/3d/use3DInteractions.ts` |
| Chat Bubbles | `src/composables/3d/use3DChatBubbles.ts` |
| Chat Bubble Component | `src/components/game/ChatBubble3D.vue` |
| Container Menu | `src/composables/3d/use3DContainerMenu.ts` |
| Placement Mode | `src/composables/3d/use3DPlacement.ts` |
| Habitat Care | `src/composables/3d/use3DHabitatCare.ts` |
| 3D Hand Model | `src/composables/3d-models/use3DHand.ts` |
| Food Models | `src/composables/3d-models/food/` |
| Model Viewer | `src/components/debug/prototypes/ModelViewerDebug.vue` |
| Habitat Debug | `src/components/debug/environment/Habitat3DDebug.vue` |
| Habitat Conditions | `src/stores/habitatConditions.ts` |

---

## Documentation Links

- [Project Plan](../../PROJECT_PLAN.md)
- [Development Phases](../../DEVELOPMENT_PHASES.md)
- [Previous Sprint](../phase3.5/archived/SPRINT-2025-12-28.md)
