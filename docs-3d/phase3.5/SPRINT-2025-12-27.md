# GPS2 3D Sprint - December 27, 2025

**Started:** December 27, 2025
**Status:** Active
**Branch:** GPS2-58
**Previous Sprint:** [SPRINT-2025-12-25.md](./archived/SPRINT-2025-12-25.md)

---

## Sprint Goals

**Focus:** Behavior Parity, UI Polish, Bug Fixes

**Priority Areas:**
1. Complete all autonomous guinea pig behaviors (3D parity with 2D)
2. Fix bugs and improve UX (activity feed, camera, keyboard shortcuts)
3. UI renaming and polish
4. Visual polish for guinea pig appearance

---

## Completed This Sprint

- [x] **Fix animations not pausing** - Clouds and water bottle bubbles now pause when game is paused
- [x] **Move Help FAB to left side** - Repositioned for better UI balance
- [x] **Sidebar button icon** - Changed from üì¶ to ‚ò∞, title to "Control Panel"
- [x] **Consolidate Help overlay to BaseDialog** - Created HelpDialog.vue, removed ~120 lines of custom CSS from Habitat3DDebug.vue, fixes scrolling issues
- [x] **Dialog scroll lock** - BaseDialog now locks body scroll when open, with scrollbar width compensation to prevent layout shift
- [x] **Fix food consumption bug** - Guinea pigs now properly consume food from bowls and hay from racks when eating (was only satisfying hunger need without removing food)
- [x] **Fix Activity Feed** - Added activity logging to 3D behavior system (was missing loggingStore calls for eating, drinking, grooming, sheltering, sleeping, pooping)
- [x] **Enhanced Habitat Physics** - Added physics system for ball/stick items: velocity, damping, collision, rolling animation, click interaction

---

## Active Tasks

### Code & CSS Audit ‚úÖ
**Priority:** HIGH (P1)
**Category:** Code Quality
**Status:** COMPLETE

**Goal:** Audit new code added since last audit (Dec 25 sprint)

**Files Audited:**
- [x] `ActionResultDialog.vue` - PASS
- [x] `usePopover.ts` - PASS
- [x] `HelpDialog.vue` - PASS

**Fixes Applied:**
- [x] `stats.css` - Fixed `border-bottom` ‚Üí `border-block-end`

**Checklist:**
- [x] TypeScript strict compliance
- [x] BEM naming convention
- [x] CSS logical properties
- [x] CSS variables usage
- [x] Memory management (cleanup)
- [x] Error handling

---

### Enhanced Habitat Physics (Prerequisite for Play/Chew) ‚úÖ
**Priority:** HIGH (P1)
**Category:** Feature
**Status:** COMPLETE

**Goal:** Add physics to habitat items like in 3D demo

**Why First:** Physics system is needed for Play and Chew behaviors:
- **Chewing:** May need to disable/lock physics while guinea pig is chewing an item
- **Playing:** Need controlled physics during play interaction (push ball, bat stick)
- **Wandering/Idle:** Allow natural free physics (items can be bumped, roll naturally)
- **Take Control mode:** Physics should respond naturally to guinea pig movement

**Features Implemented:**
- [x] Clicking stick/ball makes them roll naturally
- [x] Guinea pig can push stick, ball, and other appropriate items
- [x] Physics state management (locked, controlled, free)

**Files Created:**
- `src/types/physics3d.ts` - Physics types and presets (ball, stick configs)
- `src/stores/physics3DStore.ts` - Pinia store for physics state
- `src/composables/3d/use3DPhysics.ts` - Physics composable with update loop

**Files Modified:**
- `src/composables/use3DItems.ts` - Auto-registers ball/stick for physics
- `src/components/debug/environment/Habitat3DDebug.vue` - Physics in animation loop + click handler

**Physics Implementation Details:**
- Ball: damping 0.96, bounce 0.7, perpendicular rolling
- Stick: damping 0.90, bounce 0.5, X-axis rolling
- Guinea pig collision: pushes items when within 1.6 units
- Wall collision: clamps position, reflects velocity
- Obstacle collision: pushes out of obstacles, reflects velocity

---

### Complete All Autonomous Actions
**Priority:** HIGH (P1)
**Category:** Behavior Parity
**Status:** IN PROGRESS (Physics prerequisite complete)

**Goal:** Implement remaining autonomous behaviors in 3D to match 2D parity

**Current 3D Behaviors:**
- [x] Eating (food bowl)
- [x] Drinking (water bottle)
- [x] Sleeping
- [x] Seek Shelter
- [x] Grooming
- [x] Pooping
- [x] Idle wandering
- [x] Hay eating (consumes hay from rack)

**Missing 3D Behaviors (require physics):**
- [x] **Playing** - Find toys, play animation, satisfy play need ‚úÖ
  - Implementation: GP walks to toy, shakes it (head waggle), headbutts it (toy rolls via physics)
  - Threshold: 55%, Cooldown: 90s, Duration: 6s, Restore: 35%
  - Files: `use3DBehavior.ts`, `use3DGuineaPig.ts`, `use3DPhysics.ts`, `Habitat3DDebug.vue`
- [ ] **Chewing** - Find chew items, chew animation, satisfy chew need
  - 2D reference: `useGuineaPigBehavior.ts` - activity 'chewing', threshold 60%
  - Needs: item detection for `subCategory === 'chews'`
  - Needs: chew animation trigger
  - Needs: chew need satisfaction on completion
  - Requires: Physics system to lock item while being chewed

**Note:** Socializing behavior moved to GP2GP section (requires multi-guinea-pig coordination)

**Files to Modify (for Chewing):**
- `src/composables/3d/use3DBehavior.ts` - Add chew behavior logic
- `src/composables/use3DGuineaPig.ts` - Add chew animations

---

### Fix Activity Feed ‚úÖ
**Priority:** HIGH (P1)
**Category:** Bug Fix
**Status:** COMPLETE

**Issue:** Activity feed not showing any logs except pause and resume messages

**Root Cause:** The 3D behavior system (`use3DBehavior.ts`) was implemented without activity logging - no import of `loggingStore` and no calls to log behavior completions.

**Fixes Applied:**

**1. Autonomous Behavior Logging** (`use3DBehavior.ts`):
- `finishEating()` - logs eating food/hay with appropriate emoji
- `finishDrinking()` - logs drinking water üíß
- `finishGrooming()` - logs grooming ‚ú®
- `finishSheltering()` - logs leaving shelter üè†
- `finishSleeping()` - logs waking up üò¥
- `checkAutonomousPooping()` - logs pooping üí© (as environmental event)

**2. Player Action Logging** (`Habitat3DDebug.vue`):
- `fabQuickClean()` - logs quick clean result üßΩ
- `fabRefillWater()` - logs water refill with amount üíß
- `handleRefillWater()` - logs water refill from bottle menu üíß
- `handleContainerFill()` - logs filling hay rack üåæ
- `handleContainerClear()` - logs clearing hay rack üåæ or food bowl ü•ó
- `handleAddItemToContainer()` - logs adding food to bowl (with food name/emoji) or hay to rack üåæ

**3. Hay Management Dialog Logging** (`HayManagementDialog.vue`):
- `handleAddServing()` - logs adding hay to rack üåæ
- `handleClearRack()` - logs clearing hay rack üåæ
- `handleReplaceAll()` - logs replacing all hay with count üåæ

**4. Activity Feed Display Fix** (`Habitat3DDebug.vue`):
- Reversed message order so newest appear at top: `[...loggingStore.activityMessages].reverse()`

---

### 3D Game View Improvements ‚úÖ
**Priority:** HIGH (P1)
**Category:** UX
**Status:** COMPLETE

**Tasks:**
- [x] On page load, camera should have a clear centered view of the entire habitat
  - Changed INITIAL_POSITION from `{ x: 10, y: 15, z: 30 }` to `{ x: 0, y: 22, z: 28 }`
- [x] When not in fullscreen, show pause button next to Enter Fullscreen button
  - Added pause/resume button to game-view__header
- [x] Rename class `habitat-3d-debug__normal-header` to `game-view__header`
  - Updated class in template and CSS

---

### Keyboard Shortcuts ‚úÖ
**Priority:** MEDIUM (P2)
**Category:** UX
**Status:** COMPLETE

**Tasks:**
- [x] Add shortcut for pause/play:
  - `Space` toggles pause/resume (shows pause dialog)
  - `Shift+Space` toggles pause/resume silently (no dialog)
- [x] Optimize camera control keyboard shortcuts:
  - `Q/E` for rotation (more intuitive than comma/period)
  - `R` to reset camera to initial position
  - Comma/period kept for backward compatibility
- [x] Add Shift+Drag for camera panning:
  - Regular drag = rotate view
  - `Shift+Drag` = pan camera (move X/Z position)

**Files Modified:**
- `src/stores/gameController.ts` - Added 'silent' pause reason
- `src/composables/use3DCamera.ts` - Q/E rotation, R reset, Shift+drag pan
- `src/components/debug/environment/Habitat3DDebug.vue` - Space/Shift+Space for pause
- `src/components/game/dialogs/HelpDialog.vue` - Updated shortcuts documentation
- `src/constants/3d.ts` - Added MOUSE_PAN_SPEED constant

---

### User-to-GP FAB & Interactions
**Priority:** MEDIUM (P2)
**Category:** Feature / UI

**Goal:** Rename Guinea Pigs FAB and implement user-initiated interactions - parity with 2D game

**UI Tasks:**
- [ ] Rename "Guinea Pigs" game-fab to something cuter (represents User-to-GP actions)
- [ ] Update icon to represent interactions
- [x] Change inventory sidebar button icon to something more generic
  - Changed from üì¶ to ‚ò∞ (hamburger menu)

**2D Actions to Port:**
- Pet
- Groom
- Hand feed
- Pick up
- Other interactions from 2D

---

### Guinea Pig Sidebar Tab Implementation
**Priority:** MEDIUM (P2)
**Category:** UI Feature

**Goal:** Build out the Guinea Pigs tab in the right sidebar (currently placeholder)

**Features to Include:**
- Full needs display with bars (all 11 needs)
- Guinea pig info (name, breed, gender, fur color/pattern)
- Friendship info
- Activity history/log

**Reference:** 2D `GuineaPigPanel.vue` for layout/features

**Files to Modify:**
- `src/components/game/Inventory3DPanel.vue` - Build out Guinea Pigs tab content

---

### Item Removal from Habitat
**Priority:** MEDIUM (P2)
**Category:** Feature

**Goal:** Allow removing placed items (toys, balls, tunnels, shelters) from habitat back to inventory

**Implementation:**
- Add click menu on placed items with "Remove" option
- Call `habitatConditions.removeItemFromHabitat()` and `inventoryStore.unmarkAsPlacedInHabitat()`

**Notes:**
- 2D version only has removal for chew items (via hover popover)
- Backend already exists, just need UI trigger

---

### Chat Bubbles
**Priority:** MEDIUM (P2)
**Category:** Feature

**Goal:** Add guinea pig chat bubbles for reactions - parity from 2D game

**Questions:**
- Would 3D chat bubbles look cute?
- Flat 3D (billboard style)?

---

### Refactor Habitat3DDebug Component
**Priority:** MEDIUM (P2)
**Category:** Code Quality

**Goal:** Extract logic from oversized component into composables before it grows further

**Extraction Candidates:**
- Container menu logic ‚Üí composable
- Placement mode logic ‚Üí composable
- FAB handlers ‚Üí composable
- Water bottle menu ‚Üí separate component

---

## Backlog (Future Refinement)

### Guinea Pig to Guinea Pig Actions (GP2GP) & Socializing Behavior
**Priority:** MEDIUM (P2)
**Category:** Feature / Behavior Parity

**Goal:** Implement GP-to-GP social actions and autonomous socializing - parity with 2D game

**Autonomous Socializing Behavior:**
- [ ] Guinea pig seeks out another guinea pig when social need is low
- [ ] Approach animation, social interaction, satisfy social need
- 2D reference: `useSocialBehaviors.ts`

**Player-Initiated GP2GP Actions:**
- Social interaction
- Play together
- Groom each other
- Greet
- Check out

**Notes:**
- Requires multi-guinea-pig coordination logic
- May need pathfinding to locate other guinea pigs
- Social interactions affect both guinea pigs' needs

**Files to Modify:**
- `src/composables/3d/use3DBehavior.ts` - Add social behavior
- `src/composables/3d/use3DSocialBehaviors.ts` - New composable for GP2GP

---

### Replace Comfort Need with Stimulation
**Priority:** MEDIUM (P2)
**Category:** Game Design

**Goal:** Replace comfort need with stimulation need

**Notes:** This is documented in the docs folder somewhere

---

### 3D Models
**Priority:** MEDIUM (P2)
**Category:** Assets

**Tasks:**
- Create 3D models for other food items
- Enhance hay 3D model
- Create 3D models for some other habitat items

---

### Fix Guinea Pig Collisions
**Priority:** MEDIUM (P2)
**Category:** Bug Fix

**Issue:** Guinea pigs walk through arch tunnel, igloo walls, water bottle

**Goal:** Proper collision detection/avoidance

---

### Water Bottle Drinking Animation
**Priority:** LOW (P3)
**Category:** Animation

**Goal:** Guinea pig visually drinks through water bottle spout

---

### Multiple Item Instances Testing
**Priority:** LOW (P3)
**Category:** Testing

**Goal:** Test adding multiple instances of:
- Food containers
- Water bottles
- Toys, etc.

---

### Mini Progress Bars in Habitat Care FABs
**Priority:** LOW (P3)
**Category:** UI Enhancement

**Goal:** When Habitat Care FAB is expanded, show mini progress bars in each pill

**Metrics:**
- Water level %
- Hay freshness % (average of all racks)
- Bedding freshness %
- Poop ratio (poops until dirty)

---

### Clean Up Hay Rack UI
**Priority:** LOW (P3)
**Category:** UI Polish

**Goal:** Review and polish hay rack related UI components

---

### Enhance Groom Animation
**Priority:** LOW (P3)
**Category:** Animation

**Goal:** Improve the current grooming animation

---

### Create Fur Patterns
**Priority:** LOW (P3)
**Category:** Visual Polish

**Reason:** Complex texture work, solid colors sufficient for MVP.

---

## Reference Files

| Feature | Reference |
|---------|-----------|
| Unified Behavior System | `src/composables/3d/use3DBehavior.ts` |
| Movement Controller | `src/composables/3d/use3DMovement.ts` |
| Guinea Pig Animation | `src/composables/use3DGuineaPig.ts` |
| Habitat Containers | `src/composables/useHabitatContainers.ts` |
| Hay Management Dialog | `src/components/game/dialogs/HayManagementDialog.vue` |
| Container Menu | `src/components/basic/ContainerContentsMenu.vue` |
| Inventory Panel | `src/components/game/Inventory3DPanel.vue` |
| Habitat Debug | `src/components/debug/environment/Habitat3DDebug.vue` |
| Habitat Conditions Store | `src/stores/habitatConditions.ts` |
| 2D Behavior Reference | `src/composables/useGuineaPigBehavior.ts` |
