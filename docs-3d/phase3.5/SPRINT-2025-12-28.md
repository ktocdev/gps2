# GPS2 3D Sprint - December 28, 2025

**Started:** December 28, 2025
**Status:** Active
**Branch:** GPS2-60
**Previous Sprint:** [SPRINT-2025-12-27.md](./archived/SPRINT-2025-12-27.md)

---

## Previous Sprint Summary (Dec 27, 2025)

A highly productive sprint focused on **Behavior Parity**, **UI Polish**, and **User Interactions**.

### Major Accomplishments:
- **Physics System** - Ball/stick physics with velocity, damping, collision, and rolling animations
- **Autonomous Behaviors** - Playing (with popcorn animation!) and Chewing now fully implemented
- **3D Hand Model** - Simpsons-style yellow hand with articulated fingers and multiple poses
- **Petting Interaction** - Complete flow with hand animation, need fulfillment, and activity logging
- **Hand Feed Interaction** - Food selection dialog, gripping pose, food morsel animation, inventory consumption
- **Guinea Pig Sidebar** - User friendship, GP-to-GP bonding, info section, activity history
- **Keyboard Shortcuts** - Space for pause, Q/E for rotation, R for reset, Shift+drag for pan
- **Activity Feed** - Fixed logging for all autonomous behaviors and player actions

### Code Audit Results (Dec 28):

**Files Audited:**
- `Inventory3DPanel.vue` - Guinea Pig sidebar tab
- `FoodSelectionDialog.vue` - Food selection dialog
- `use3DHand.ts` - Hand model & poses
- `Habitat3DDebug.vue` - Hand feed animation

**Issues Found & Fixed:**
| Priority | Issue | Fix Applied |
|----------|-------|-------------|
| HIGH | Index out of bounds when GP removed | Added safe index clamping in `selectedGuineaPig` computed |
| MEDIUM | Food selection persists across category changes | Added `watch(selectedCategory)` to reset selection |
| MEDIUM | CSS `margin` shorthand instead of logical properties | Changed to `margin-block-*` and `margin-inline` |
| LOW | `handFeedFoodMesh` not explicitly cleaned on unmount | Added explicit cleanup before `interactionHand` disposal |

**Passed Checks:**
- BEM naming convention
- CSS variables usage
- TypeScript types
- THREE.js resource cleanup
- Global styles (no scoped)

---

## Sprint Goals

**Focus:** Complete Remaining Interactions, Polish, Bug Fixes

**Priority Areas:**
1. Implement remaining 5 Interact FAB actions (Hold, Gentle Wipe, Show Toy, Peek-a-Boo, Talk To)
2. Code quality improvements (refactoring, cleanup)
3. UI polish and bug fixes

---

## Active Tasks

### User-to-GP FAB & Interactions (Rollover)
**Priority:** HIGH (P1)
**Category:** Feature
**Status:** IN PROGRESS

**Goal:** Complete remaining user-initiated interactions - parity with 2D game

**Completed:**
- [x] Interact FAB with ðŸ’› icon
- [x] FabSubnavMenu component (7 actions grid)
- [x] 3D Hand Model with poses (open, closed, pointing, petting, holding, wave, gripping)
- [x] Pet interaction (animation, need fulfillment, activity logging)
- [x] Hand Feed interaction (food dialog, gripping animation, inventory consumption)

**Remaining Actions (5):**
- [ ] **Hold (ðŸ«´)** - Pick up guinea pig, hold animation
  - Social need: +20-30%
  - Friendship: +2
- [ ] **Gentle Wipe (ðŸ§¼)** - Cleaning interaction
  - Cleanliness need: +40-50%
  - Social need: +5%
  - Friendship: +1
- [ ] **Show Toy (ðŸ§¸)** - Show toy to guinea pig
  - Play need: +10-15%
  - Social need: +5%
  - Friendship: +1
- [ ] **Peek-a-Boo (ðŸ‘€)** - Playful interaction
  - Social need: +10%
  - Friendship: +1
- [ ] **Talk To (ðŸ’¬)** - Voice interaction
  - Social need: +10-15%
  - Friendship: +1

**Files to Modify:**
- `src/components/debug/environment/Habitat3DDebug.vue` - Add interaction handlers
- `src/composables/3d-models/use3DHand.ts` - May need new poses

---

### Item Removal from Habitat
**Priority:** MEDIUM (P2)
**Category:** Feature

**Goal:** Allow removing placed items (toys, balls, tunnels, shelters) from habitat back to inventory

**Implementation:**
- Add click menu on placed items with "Remove" option
- Call `habitatConditions.removeItemFromHabitat()` and `inventoryStore.unmarkAsPlacedInHabitat()`

**Notes:**
- 2D version only has removal for chew items (via hover popover)
- Backend already exists, just need UI trigger

---

### Refactor Habitat3DDebug Component
**Priority:** MEDIUM (P2)
**Category:** Code Quality

**Goal:** Extract logic from oversized component into composables before it grows further

**Extraction Candidates:**
- Container menu logic â†’ composable
- Placement mode logic â†’ composable
- FAB handlers â†’ composable
- Water bottle menu â†’ separate component
- Interaction handlers â†’ composable

---

### Chat Bubbles
**Priority:** MEDIUM (P2)
**Category:** Feature

**Goal:** Add guinea pig chat bubbles for reactions - parity from 2D game

**Questions:**
- Would 3D chat bubbles look cute?
- Flat 3D (billboard style)?

---

## Backlog

### Guinea Pig to Guinea Pig Actions (GP2GP) & Socializing Behavior
**Priority:** MEDIUM (P2)
**Category:** Feature / Behavior Parity

**Goal:** Implement GP-to-GP social actions and autonomous socializing - parity with 2D game

**Autonomous Socializing Behavior:**
- [ ] Guinea pig seeks out another guinea pig when social need is low
- [ ] Approach animation, social interaction, satisfy social need
- 2D reference: `useSocialBehaviors.ts`

**Player-Initiated GP2GP Actions:**
- Social interaction
- Play together
- Groom each other
- Greet
- Check out

**Notes:**
- Requires multi-guinea-pig coordination logic
- May need pathfinding to locate other guinea pigs
- Social interactions affect both guinea pigs' needs

---

### Replace Comfort Need with Stimulation
**Priority:** MEDIUM (P2)
**Category:** Game Design

**Goal:** Replace comfort need with stimulation need

**Notes:** This is documented in the docs folder somewhere

---

### 3D Models
**Priority:** MEDIUM (P2)
**Category:** Assets

**Tasks:**
- Create 3D models for other food items
- Enhance hay 3D model
- Create 3D models for some other habitat items

---

### Fix Guinea Pig Collisions
**Priority:** MEDIUM (P2)
**Category:** Bug Fix

**Issue:** Guinea pigs walk through arch tunnel, igloo walls, water bottle

**Goal:** Proper collision detection/avoidance

---

### Water Bottle Drinking Animation
**Priority:** LOW (P3)
**Category:** Animation

**Goal:** Guinea pig visually drinks through water bottle spout

---

### Multiple Item Instances Testing
**Priority:** LOW (P3)
**Category:** Testing

**Goal:** Test adding multiple instances of:
- Food containers
- Water bottles
- Toys, etc.

---

### Mini Progress Bars in Habitat Care FABs
**Priority:** LOW (P3)
**Category:** UI Enhancement

**Goal:** When Habitat Care FAB is expanded, show mini progress bars in each pill

**Metrics:**
- Water level %
- Hay freshness % (average of all racks)
- Bedding freshness %
- Poop ratio (poops until dirty)

---

### Bedding Items in Inventory Panel Should Look Disabled
**Priority:** LOW (P3)
**Category:** UI Enhancement

**Goal:** Bedding Items in the Inventory Panel should look disabled and grayed out to prevent confusion.

---

### Enhance Groom Animation
**Priority:** LOW (P3)
**Category:** Animation

**Goal:** Improve the current grooming animation

---

### Create Fur Patterns
**Priority:** LOW (P3)
**Category:** Visual Polish

**Reason:** Complex texture work, solid colors sufficient for MVP.

---

## Reference Files

| Feature | Reference |
|---------|-----------|
| Unified Behavior System | `src/composables/3d/use3DBehavior.ts` |
| Movement Controller | `src/composables/3d/use3DMovement.ts` |
| Guinea Pig Animation | `src/composables/use3DGuineaPig.ts` |
| 3D Hand Model | `src/composables/3d-models/use3DHand.ts` |
| 3D Model Sync | `src/composables/use3DSync.ts` |
| Habitat Containers | `src/composables/useHabitatContainers.ts` |
| Hay Management Dialog | `src/components/game/dialogs/HayManagementDialog.vue` |
| Food Selection Dialog | `src/components/game/dialogs/FoodSelectionDialog.vue` |
| Container Menu | `src/components/basic/ContainerContentsMenu.vue` |
| Inventory Panel | `src/components/game/Inventory3DPanel.vue` |
| Friendship Progress | `src/components/game/ui/FriendshipProgress.vue` |
| FAB Subnav Menu | `src/components/game/FabSubnavMenu.vue` |
| FAB Subnav Styles | `src/styles/fab-subnav.css` |
| Habitat Debug | `src/components/debug/environment/Habitat3DDebug.vue` |
| Habitat Conditions Store | `src/stores/habitatConditions.ts` |
| 2D Behavior Reference | `src/composables/useGuineaPigBehavior.ts` |
