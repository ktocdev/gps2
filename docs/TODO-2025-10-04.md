# GPS2 Implementation TODO - October 4, 2025

**Created:** October 4, 2025
**Last Updated:** October 5, 2025
**Status:** Phase 2 Complete ‚úÖ - Ready for Phase 3
**Branch:** GPS2-18
**Archive:** [TODO-2025-09-28.md](archive/TODO-2025-09-28.md)

---

## üéØ **Active Tasks**

### Manual Testing
- [x] Validate all Phase 2 systems integration ‚úÖ COMPLETE
- [x] Test needs decay and wellness calculation (High-level testing complete, complex testing deferred to post-Phase 3)
- [x] Verify favorites system edge cases
- [x] Check game timing and pause/resume
- [ ] Mobile responsiveness verification
- [x] Test 24 hour refresh timer after closing browser for a while

### Bugs to Fix
- [x] **Pet Store Refresh Not Charging Money** ‚úÖ FIXED
  - Fixed: Now charges End Game Penalty ($50 default) for manual refresh
  - Auto-refresh remains free
  - Active and favorited guinea pigs preserved during refresh
  - Available list shows: Active (blue badge) ‚Üí Favorites ‚Üí New guinea pigs

### UI/UX Polish
- [x] **System Controls & Game State Integration** ‚úÖ COMPLETE
  - **System Controls Panel:** Centralized system management in GameController
    - Created "System Controls" panel with Needs Processing toggle
    - Merged "Game Controls" + "Current State" ‚Üí "Game State & Controls"
    - Shows state: Active ‚úì / Paused (Auto) / Paused (Manual) ‚ö†Ô∏è
    - Syncs perfectly between GameController and NeedsDebug (reactive state)
    - Disabled when no active session or game is paused
    - Future-ready for Habitat Decay and Guinea Pig Bonding systems
  - **Auto-Reset Logic:** Watcher in needsController automatically resets manual pause when session ends
  - **Smart Quick Actions (10 total):** All disable when game paused OR needs processing paused OR associated need at 100%
    - Feed Pellets/Vegetables ‚Üí disabled when hunger ‚â• 100%
    - Give Water ‚Üí disabled when thirst ‚â• 100%
    - Clean ‚Üí disabled when hygiene ‚â• 100%
    - Play ‚Üí disabled when play OR social ‚â• 100%
    - Chew Toy ‚Üí disabled when stimulation ‚â• 100%
    - Trim Nails ‚Üí disabled when comfort ‚â• 100%
    - **Provide Shelter** ‚Üí disabled when shelter ‚â• 100% (NEW)
    - **Health Check** ‚Üí disabled when health ‚â• 100% (NEW)
    - Soothe to Sleep ‚Üí disabled when happiness ‚â• 100%
    - **Informative tooltips** explain why actions are disabled
  - **New Interaction Methods:**
    - Created `performHealthCheck()` in guineaPigStore (+20 health, +5 happiness)
    - Added `generateHealthCheckMessage()` in MessageGenerator (üè• emoji)
  - **Game Session Controls:** "Start Session" button shows "Game in Session" when active
  - **24-Hour Auto-Refresh:** Enabled by default, timer initializes on first load
  - **CSS Fixes:**
    - Text color utilities (`.text--success/warning/muted/error/info`) in stats.css
    - Badge border consistency - all variants now have `1px solid transparent` border
    - System Controls uses `stats-grid` wrapper for consistent styling
  - **Game Balance:** American breed weight increased 100‚Üí150 (~30% spawn rate vs ~23%)
  - **Build Fixes:** Removed unused variables (`oldFriendship`, `activityType`)
  - **Files:** needsController.ts, NeedsDebug.vue, GameController.vue, petStoreManager.ts, guineaPigStore.ts, messageGenerator.ts, stats.css, Badge.vue
  - **Impact:** High - improved UX consistency, prevents user errors, centralized controls, complete need coverage

- [ ] **Create Details Component**
  - Reusable component for Guinea Pig editor sections
  - Mobile-responsive design with BEM methodology

### Phase 3 Prep
- [ ] Begin Phase 3 planning (Game World & Environment)
- [x] Update PROJECT_PLAN.md with Phase 2 completion ‚úÖ COMPLETE
- [x] Update DEVELOPMENT_PHASES.md with Phase 2 completion ‚úÖ COMPLETE
- [ ] Review Phase 3 documentation

---

## ‚úÖ **Completed This Session**

### Bug Fixes
- **Pet Store Refresh Charging** - Now charges End Game Penalty for manual refresh, preserves active/favorite guinea pigs
- **Pause/Resume Bug** - Fixed needs decay accumulation during pause
- **Activity Feed Messages** - All interactions now show in activity feed with varied messages
- **Favorites Duplicates** - Prevented duplicate favoriting with visual indicators
- **Guinea Pigs Adopted Count** - Now correctly tracks total across sessions
- **System Message Spam** - Reduced from 151+ messages to just player actions
- **Wellness Calculation** - Fixed inverted formula
- **Game State Messages** - Differentiate between "start" and "resume" contexts

### Accessibility Improvements
- **SliderField Component** - Added `id` prop support, renamed from Slider.vue
- **CheckboxField Component** - Created accessible checkbox with auto-generated IDs
- **Select Component** - Added `ariaLabel` prop for unlabeled selects
- **Form Labels** - Fixed all label associations across debug panels:
  - LoggingSystem.vue: 4 inputs/selects
  - PetStoreDebug.vue: 27 inputs/selects (including 26 preference selects)
  - SystemMonitor.vue: Search input with visually-hidden label
  - NeedsDebug.vue: Slider labels with proper for/id

### UI Enhancements
- **Controls Grid** - Mobile-responsive button layout moved to base.css
- **Button with Badge** - Reusable pattern moved to base.css
- **Pause Indicator** - Added "Paused by Game" badge to Needs Debug
- **Button Text Wrapping** - Enabled for better mobile UX
- **Enhanced Activity Messages** - 8 action-specific generators with 5+ templates each

### Code Quality
- **CSS Cleanup** - Removed unused checkbox styles from forms.css
- **Fieldset Reset** - Added base reset styles
- **Component Consistency** - All checkboxes use CheckboxField, all form selects use Select

---

## üìù **Bug Fix Details**

### Pause/Resume Bug - FIXED
**Issue:** Needs continued to decay after pausing
**Fix:** Reset `needsLastUpdate` timestamps in [needsController.ts:202](src/stores/needsController.ts#L202)
**Impact:** High - core pause functionality working correctly

### Activity Feed Messages - FIXED
**Issue:** Quick actions didn't show in feed
**Fix:** Changed to use `addPlayerAction()` with MessageGenerator
**Impact:** Medium - all interactions now visible with varied, engaging messages

### Favorites Duplicates - FIXED
**Issue:** Could favorite active guinea pigs multiple times
**Fix:** Added duplicate check, visual "FAVORITED" badge, disabled button state
**Impact:** High - prevents data corruption

### Excessive Logging - FIXED
**Issue:** 151+ system messages after few interactions
**Fix:** Removed verbose 5s interval logging, consolidated duplicate init messages
**Impact:** High - dramatically reduced message spam

### Guinea Pigs Adopted Count - FIXED
**Issue:** Count only incremented by 1 regardless of session size
**Fix:** Pass actual count to `incrementGuineaPigsAdopted()`
**Impact:** Medium - accurate stat tracking

### Pet Store Refresh Charging - FIXED
**Issue:** Manual refresh didn't charge money; active/favorite guinea pigs disappeared from available list
**Fix:**
- Added penalty deduction in [petStoreManager.ts:577-581](src/stores/petStoreManager.ts#L577-L581)
- Preserve active guinea pigs during refresh (lines 591-609)
- Preserve favorited guinea pigs during refresh (lines 614-627)
- Only generate new guinea pigs for remaining slots (lines 629-638)
- Sort available list: Active ‚Üí Favorites ‚Üí New guinea pigs
- Changed active badge from green to blue (info variant)
**Impact:** High - proper economy balance, improved UX, favorites always visible

---

## üìä **Phase Status**

**Phase 2 Complete ‚úÖ**
- Pet Store & Game Session Manager (6.5)
- Guinea Pig Store Core (6)
- Favorites System (6.9)
- Needs System (7)
- Game Timing System (8-10)

**Phase 3 Ready üìã**
- Habitat Conditions (11)
- Habitat Items & Inventory (12-13)
- Habitat Maintenance (14)

---

## üîß **Development**

**Commands:**
- Build: `npm run build` (run before commits)
- Dev: `npm run dev`

**Testing Guide:** [NEEDS_SYSTEM_TESTING_GUIDE.md](testing/NEEDS_SYSTEM_TESTING_GUIDE.md)
