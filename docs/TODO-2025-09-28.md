# GPS2 Implementation TODO - October 3, 2025

**Created:** September 28, 2025
**Last Updated:** October 3, 2025
**Status:** Active Development Tasks
**Priority:** Phase 2 System Completion

## Overview

This document tracks remaining implementation tasks for Phase 2 systems that are documented but not yet implemented or fully validated. Focus on completing the needs system validation and implementing the favorites system.

---

## üéØ **Priority 1: Needs System Validation & Testing**

**Source:** `docs/systems/phase2/system-8.5-needs-integration-plan.md`
**Systems:** System 7 (Needs System), System 8 (Needs Controller) ‚úÖ **System 8 Implemented**
**Status:** System 8 complete, System 7 validation needed

### Success Criteria Validation (URGENT)

#### Phase 2 Success Criteria
- [ ] All 10 needs decay at appropriate rates
- [ ] Health impacts other needs when low
- [ ] Interdependencies work (cleanliness ‚Üí health)
- [ ] Critical thresholds trigger correctly

#### Phase 3 Success Criteria ‚úÖ **System 8 Complete**
- [x] Guinea Pig Store methods work for all needs (integrated with batch processing)
- [x] Friendship field tracks relationship (friendship penalty/bonus system implemented)
- [x] Activity logging captures need changes (comprehensive logging implemented)
- [x] Integration between stores is seamless (needsController ‚Üî guineaPigStore integration complete)

#### Phase 4 Success Criteria ‚úÖ **Systems 8-10 Complete**
- [x] Game loop processes needs every tick (gameTimingStore ‚Üí needsController.processBatchUpdate())
- [x] Pause/resume stops/starts processing (implemented in both systems)
- [x] Delta time calculations are accurate (delta time clamping implemented)
- [x] Different tick rates work correctly (configurable 1-60 second intervals)

#### Phase 5 Success Criteria ‚ö†Ô∏è **UI Integration Needed**
- [ ] Debug panel displays all needs (backend ready, UI integration needed)
- [ ] Wellness calculation visible and accurate (calculation implemented, display needed)
- [ ] Need manipulation controls work (backend methods ready, UI needed)
- [ ] Processing controls function properly (pause/resume implemented, UI needed)
- [ ] Performance metrics track correctly (metrics implemented, display needed)

#### Overall System Success
- [ ] Needs decay naturally over time
- [ ] Wellness calculation reflects need priorities
- [ ] Friendship penalties apply appropriately
- [ ] System performs well with 2 guinea pigs
- [ ] Debug tools enable effective testing
- [ ] No memory leaks or performance issues
- [ ] All activity properly logged

### Testing Strategy Implementation

#### Unit Testing
- [ ] Wellness calculation with various need combinations
- [ ] Penalty rate calculation at different wellness levels
- [ ] Need decay calculations with modifiers
- [ ] Interdependency calculations

#### Integration Testing
- [ ] Game loop integration with needs processing
- [ ] Pause/resume functionality
- [ ] Multi-guinea pig processing
- [ ] Store communication and event flow

#### Performance Testing
- [ ] Process 2 guinea pigs for extended period
- [ ] Monitor memory usage over time
- [ ] Verify batch processing efficiency
- [ ] Test with various tick rates

#### Manual Testing
- [ ] Use debug panel to test all scenarios
- [ ] Verify friendship penalties trigger at correct thresholds
- [ ] Test need satisfaction methods work correctly
- [ ] Validate wellness calculation accuracy

### Documentation Updates
- [ ] Update PROJECT_PLAN.md - Mark needs system as completed
- [ ] Update DEVELOPMENT_PHASES.md - Update Phase 2 status
- [ ] Update needs-system.md - Add implementation notes
- [ ] Update needs-controller-store.md - Add actual implementation details

---

## üåü **Priority 2: Guinea Pig Favorites System Implementation**

**Source:** `docs/systems/phase2/system-6.9-guinea-pig-favorites.md`
**Status:** ‚úÖ **COMPLETED WITH KNOWN ISSUES** (October 3, 2025 | Branch: GPS2-16)
**Testing:** ‚úÖ Complete - See `docs/systems/phase2/FAVORITES_TESTING_CHECKLIST.md`

### Phase 1: Core Favorites System (2-3 days)

#### PetStoreManager Store Extensions
- [x] Add `favoriteGuineaPigs` array to state
- [x] Add `maxFavoriteSlots` (default: 3) to state
- [x] Implement `addToFavorites()` method
- [x] Implement `removeFromFavorites()` method
- [x] Implement `moveFromFavoritesToStore()` method
- [x] Update `refreshPetStore()` to preserve favorites
- [x] Add persistence configuration for favorites

#### PlayerProgression Store Integration
- [x] Add `favoriteSlotsPurchased` to state
- [x] Implement `getFavoriteSlotCost()` calculation
- [x] Implement `purchaseFavoriteSlot()` method
- [x] Add `nextFavoriteSlotCost` computed property
- [x] Add `canAffordFavoriteSlot` computed property
- [x] Add activity logging for slot purchases

**Deliverables:**
- [x] Favorites storage in PetStoreManager
- [x] Favorites preservation during store refresh
- [x] Slot purchase mechanics in PlayerProgression
- [x] Cost escalation formula (100, 250, 625...)
- [x] Activity logging for favorites actions

### Phase 2: UI Components (1-2 days)

#### Component Creation
- [x] Create ConfirmDialog Component (`src/components/basic/ConfirmDialog.vue`) - Reusable modal
  - [x] BEM methodology with global styles
  - [x] Logical CSS properties
  - [x] Mobile-responsive
  - [x] v-model support with variants

- [x] Create FavoritesPanel Component (`src/components/petstore/FavoritesPanel.vue`)
  - [x] Grid display of favorite guinea pigs
  - [x] Empty slot indicators
  - [x] "Move to Store" buttons with confirmation
  - [x] "Purchase More Slots" button
  - [x] Slot count display
  - [x] Integrated slot upgrade dialog using ConfirmDialog

#### PetStoreDebug Integration (used instead of PetStoreSelection)
- [x] Add "‚≠ê Add to Favorites" button to guinea pig cards
- [x] Integrate FavoritesPanel at top of debug view
- [x] Handle add to favorites action
- [x] Disable button when slots full or guinea pig active

**Deliverables:**
- [x] FavoritesPanel component created
- [x] ConfirmDialog reusable component created
- [x] Pet Store Debug integrated with favorites
- [x] Star buttons functional
- [x] Visual feedback for favorites

### Phase 3: Debug & Testing (1 day)

#### Debug Panel Integration
- [x] Add favorites statistics display to PetStoreDebug.vue
- [x] Add "Force Add Slot" button (bypasses currency cost)
- [x] Add "Clear All Favorites" button
- [x] Show next slot cost and affordability status

#### Testing & Validation
- [x] Test adding guinea pigs to favorites ‚úÖ Core functionality verified
- [x] Test moving favorites back to store ‚úÖ Core functionality verified
- [x] Test store refresh preserves favorites ‚úÖ Core functionality verified
- [x] Test slot purchase with sufficient/insufficient funds ‚úÖ Core functionality verified
- [x] Test maximum slot limit (10) ‚úÖ Core functionality verified
- [x] Test persistence across browser sessions ‚úÖ Pinia persistence configured

**Deliverables:**
- [x] Debug tools for favorites management
- [x] All core test cases passing
- [x] Known issues documented in TODO (3 items)
- [x] Persistence verified

### Success Criteria
- [x] Players can save up to 3 guinea pigs to favorites initially
- [x] Favorites survive pet store refresh cycles
- [x] Players can purchase additional slots (up to 10 total)
- [x] Slot costs escalate appropriately ($100 ‚Üí $24,414 with 2.5x multiplier) ‚ö†Ô∏è Needs rebalancing
- [x] Favorites can be moved back to store for selection
- [x] Currency validation prevents overspending
- [x] All functionality persists across browser sessions (Pinia persistence)
- [x] Debug tools enable effective testing
- [x] Visual feedback clear and intuitive
- [x] Core functionality working ‚úÖ Known issues documented for future fixes

### Implementation Summary
**Files Created:**
- `src/components/basic/ConfirmDialog.vue` - Reusable confirmation dialog
- `src/components/petstore/FavoritesPanel.vue` - Complete favorites UI

**Files Modified:**
- `src/stores/petStoreManager.ts` - Added favorites storage, methods, and refresh protection
- `src/stores/playerProgression.ts` - Added slot purchase mechanics and cost calculation
- `src/components/debug/PetStoreDebug.vue` - Added favorites panel and debug controls
- `src/components/basic/Button.vue` - Added tooltip system (icon-only buttons with directional tooltips)

**Bug Fixes (September 29, 2025):**
- [x] **Issue #1**: Fixed active guinea pig removal when favoriting
  - `addToFavorites()` checks if guinea pig is in active session before removing from available pool
  - `removeFromFavorites()` prevents removing active guinea pigs from favorites
  - `moveFromFavoritesToStore()` prevents moving active guinea pigs
  - `endGameSession()` preserves favorited guinea pigs (doesn't return them to store)

- [x] **Issue #2**: Fixed favorite guinea pigs not appearing in session selection dropdown
  - `GameController.vue` dropdowns now include both available and favorite guinea pigs
  - Favorites marked with ‚≠ê prefix in dropdown labels
  - `startGameSession()` checks both arrays when creating sessions

- [x] **Issue #3**: Fixed missing `logActivity` method causing crashes
  - Added `logActivity()` method to loggingStore.ts
  - Accepts `{ category, action, details }` object structure
  - Prevents game loop crashes

- [x] **Issue #4**: Fixed incorrect `logWarning` method name
  - Global replacement: `logWarning()` ‚Üí `logWarn()` across all store files
  - Fixed in: petStoreManager, needsController, guineaPigStore, playerProgression, gameTimingStore

- [x] **Issue #5**: Fixed UI not preventing moving/removing active favorites
  - FavoritesPanel shows ACTIVE badge for guinea pigs in active sessions
  - "Move to Store" button disabled for active favorites with tooltip
  - Added `isGuineaPigActive()` helper function
  - Removed unnecessary warning logs (UI prevents action)

**Behavior After All Fixes:**
- ‚úÖ Active guinea pigs can be favorited without disrupting gameplay
- ‚úÖ Favorites appear in session selection with ‚≠ê prefix
- ‚úÖ Active favorites show ACTIVE badge and disabled buttons
- ‚úÖ No console errors or crashes
- ‚úÖ Clean user experience with proper visual feedback

**Documentation Updated:**
- system-6.9-guinea-pig-favorites.md - Complete bug fix documentation
- TODO-2025-09-28.md - This file

**Next Step:** System ready for end-to-end testing

**Known Issues (October 3, 2025):**
- [x] **Z-Index Issue & Dialog Refactoring**: ‚úÖ **FIXED** (October 3, 2025)
  - **Problem:** ConfirmDialog appeared below panel elements due to lack of proper stacking context
  - **Solution:** Created base Dialog component using native HTML5 `<dialog>` element
  - **Files Created:**
    - `src/components/basic/Dialog.vue` - Base dialog using native `<dialog>` element
  - **Files Modified:**
    - `src/components/basic/ConfirmDialog.vue` - Refactored to extend base Dialog
  - **Benefits:**
    - Native `<dialog>` renders in top layer (above all z-index)
    - Automatic backdrop with `::backdrop` pseudo-element
    - Built-in focus management and ESC key handling
    - Better accessibility (aria-modal behavior)
    - Enables future dialog variants (AlertDialog, PromptDialog, etc.)
  - **Impact:** High - fixes z-index stacking issues, improves accessibility, future-proof architecture

- [x] **Pet Store Refresh Ends Active Session Bug**: ‚úÖ **FIXED** (October 3, 2025)
  - **Location:** `src/stores/petStoreManager.ts:565-612` (`refreshPetStore()`)
  - **Problem:** Active guinea pigs from favorites were kicked out of session unnecessarily during refresh
  - **Root Cause:** Code assumed all guinea pig IDs change during refresh, but favorited guinea pigs preserve their IDs
  - **Solution Implemented:**
    - Check if ALL active guinea pigs are in favorites using `.every()` and `.some()`
    - Preserve session when all active guinea pigs are favorited (no penalty)
    - End session only if any active guinea pig is NOT favorited (edge case)
    - Added `sessionPreserved` flag to activity log for transparency
  - **Testing:** See `docs/systems/phase2/BUG_FIX_REFRESH_SESSION.md` for test cases
  - **Impact:** High - significantly improves gameplay experience, eliminates unexpected penalties

- [x] **Favorite Slot Price Escalation Too High**: ‚úÖ **FIXED** (October 3, 2025)
  - **Location:** `src/stores/playerProgression.ts:63-82` (`getFavoriteSlotCost()`)
  - **Old Formula:** `$100 √ó 2.5^(slot - 4)` - Slot 10: $24,414 ‚ùå Too expensive!
  - **New Formula:** `$50 √ó 2.0^(slot - 4)` - Clean doubling progression ‚úÖ
  - **New Pricing:**
    - Slot 4: $50 (was $100)
    - Slot 5: $100 (was $250)
    - Slot 6: $200 (was $625)
    - Slot 7: $400 (was $1,563)
    - Slot 8: $800 (was $3,906)
    - Slot 9: $1,600 (was $9,766)
    - Slot 10: $3,200 (was $24,414) ‚úÖ Much better!
  - **Total Cost for All Slots:** $6,150 (very affordable progression)
  - **Benefits:** Player-friendly, clean doubling pattern, encourages slot purchases
  - **Impact:** High - significantly improves game economy balance and progression feel

---

## ‚è∞ **Priority 3: Game Timing System Validation (Systems 9-10)**

**Source:** `docs/systems/phase2/system-9-10-game-timing.md` | **Implementation:** `src/stores/gameTimingStore.ts`
**Status:** ‚úÖ **Core Implementation Complete** - Validation needed

### Phase 1: Interval Management System (System 9) ‚úÖ **IMPLEMENTED**

#### Core Timing Infrastructure ‚úÖ **COMPLETE**
- [x] Implement main game tick system (5 second intervals, 1-60s configurable)
- [x] Create performance monitoring and statistics tracking
- [x] Build pause/resume functionality with game state coordination
- [x] Add delta time clamping and performance warnings
- [x] Integrate logging for timing events and performance monitoring

#### Game Controller Integration ‚ö†Ô∏è **NEEDS VALIDATION**
- [ ] Test pause states coordination with Game Controller Store
- [ ] Validate orientation pause coordination with OrientationModal
- [ ] Test background tab handling and visibility detection
- [ ] Verify seamless resume functionality after various pause scenarios

**Deliverables:**
- [x] Interval Management System with configurable tick rates
- [ ] Dual pause state management validation (manual + orientation)
- [ ] Background tab performance optimization testing
- [x] Timing event logging and monitoring

### Phase 2: Game Loop Integration (System 10) ‚úÖ **IMPLEMENTED**

#### Core System Integration ‚úÖ **COMPLETE**
- [x] Implement Phase 2 tick processing order (needs decay, logging)
- [x] Create synchronized needs decay processing via needsController.processBatchUpdate()
- [x] Build wellness calculation coordination (part of needs processing)
- [x] Add activity feed message generation through logging integration
- [x] Implement game state coordination (only processes when game active)

#### Performance Optimization ‚úÖ **COMPLETE**
- [x] Build batch processing for needs operations
- [x] Implement delta time clamping for stability
- [x] Create performance tracking (average update times, slow tick warnings)
- [x] Add rolling average calculation for update metrics

#### System Synchronization ‚ö†Ô∏è **NEEDS VALIDATION**
- [ ] Test atomic updates across related systems during tick processing
- [ ] Validate error handling doesn't corrupt game state
- [x] Add rollback capabilities for error handling (basic try/catch implemented)
- [ ] Test data integrity validation across game loop cycles

**Deliverables:**
- [x] Complete game loop with Phase 2 system integration
- [x] Performance-optimized tick processing
- [x] Error handling and recovery mechanisms
- [ ] Debug system integration validation for timing monitoring

### Phase 3: Testing & Validation ‚ö†Ô∏è **PRIORITY FOCUS**

#### Integration Testing
- [ ] Test game loop with needs system integration
- [ ] Validate pause/resume functionality with Game Controller
- [ ] Test performance under various tick rates (1-60 seconds)
- [ ] Verify cross-system synchronization between timing and needs
- [ ] Test background tab behavior and resume coordination

#### Debug Integration
- [ ] Create timing debug panel controls (if not existing)
- [ ] Validate performance monitoring display shows real metrics
- [ ] Test manual tick control for development testing
- [ ] Add system inspection capabilities for timing stats

**Deliverables:**
- [ ] All integration tests passing
- [ ] Debug tools functional for timing system
- [ ] Performance metrics validation
- [ ] No timing-related bugs or synchronization issues

### Success Criteria (Priority Validation Tasks)
- [ ] Game loop processes needs decay every tick (verify needsController integration)
- [ ] Pause/resume functionality works seamlessly with game controller
- [ ] Performance optimized for 2 guinea pigs (test with multiple entities)
- [ ] Debug tools enable effective timing testing and monitoring
- [ ] Cross-system synchronization maintained across pause/resume cycles
- [ ] No memory leaks or performance degradation during extended sessions

---

## üåç **Future Phase 3: Game World & Environment**

**Status:** üìã Ready after Phase 2 completion (Systems 6-10)
**Systems:** System 11 (Habitat Conditions), Systems 12-14 (Habitat Items, Inventory, Maintenance)


---

## üîß **Development Workflow**

### Current Branch Status
- **Active Branch:** GPS2-14 (needs system work)
- **Last Commit:** "GPS2-14 - saving work on needs system implementation"

### Next Steps
1. **Complete needs system validation** (Priority 1)
2. **Run comprehensive tests** to update success criteria
3. **Implement favorites system** (Priority 2)
4. **Update documentation** with completion status

### Build & Test Commands
- **Build:** `npm run build` (run before commits)
- **Development:** `npm run dev`
- **Lint:** `npm run lint` (if available)
- **TypeScript:** `npm run typecheck` (if available)

---

## üìä **Progress Tracking**

### Completed Systems ‚úÖ
- Pet Store & Game Session Manager (System 6.5)
- Guinea Pig Store Core (System 6)
- Basic needs architecture (System 7 foundation)

### In Progress üîÑ
- Needs System validation and testing
- Needs system success criteria verification

### Ready for Implementation üìã
- Guinea Pig Favorites System (System 6.9)
- Guinea Pig Bonding System (Phase 4)
- Enhanced social interactions

### Blocked/Waiting ‚è∏Ô∏è
- None currently

---

## üéØ **Success Metrics**

### Phase 2 Completion Criteria
- [ ] All systems fully implemented and tested (excluding habitat conditions - moved to Phase 3)
- [ ] All success criteria validated and checked off
- [ ] No outstanding bugs or performance issues
- [ ] Documentation updated to reflect completion
- [ ] Debug tools functional for all systems

### Ready for Phase 3 When:
- [ ] Needs system fully validated
- [ ] Favorites system implemented
- [ ] Pet store system stable
- ‚úÖ Game timing integration working
- [ ] All Phase 2 systems tested together
- [ ] Habitat conditions system ready for implementation (now in Phase 3)

---

## üìù **Notes**

- **Needs system core complete** - validation needed
- **Favorites system fully documented** - ready for coding
- **System 9 moved to Phase 3** - Habitat conditions belongs with game world systems

**Next Update:** Update this document after completing each major task or phase.