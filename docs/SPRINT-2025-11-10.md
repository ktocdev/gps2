# GPS2 Sprint - November 10, 2025

**Started:** November 10, 2025
**Status:** Active üöß
**Branch:** GPS2-45
**Previous Sprint:** [SPRINT-2025-11-04.md](archive/SPRINT-2025-11-04.md)

**Progress:**
- üìã Sprint Started

---

## üéØ **Sprint Goals**

**Focus:** Code audit of recent work (GPS2-45), bug fixes, and Phase 5 continuation

**Priority Areas:**
1. Audit all code from GPS2-45 branch (UI/UX polish & component updates)
2. Document and fix any issues found
3. Address critical bugs (subtab nav selection, simultaneous poop, Clean Habitat)
4. Continue Phase 5 implementation (System 22 Components 2-3)

---

## üìã **Sprint Backlog**

### Code Audit & Cleanup üîç

#### Audit GPS2-45 Branch Work
**Priority:** HIGH
**Status:** üìã Not Started
**Category:** Code Quality

**Goal:** Review all code from GPS2-45 branch for consistency, best practices, and potential issues

**GPS2-45 Scope:**
The previous branch completed the following work:
- Activity Feed Sidebar component creation and styling improvements
- SubTab Navigation component enhancements (buttons-only mode, scrollbar fixes, CSS variable fixes)
- Supplies Store cleanup (removed empty STATUS column)
- Guinea Pig Sidebar emoji updates
- Behavior threshold updates (play/chew to 75%)
- Habitat Conditions sidebar consolidation
- Needs System sync improvements (Decay Speed ‚Üî Needs Processing)

**Areas to Review:**

1. **Activity Feed Improvements**
   - ActivityFeedSidebar.vue wrapper component
   - External control props (hideHeader, isPausedExternal)
   - Emits for parent communication
   - Conditional styling with :has() selector
   - Padding and contrast improvements

2. **SubTab Navigation Enhancements**
   - buttonsOnly prop implementation
   - Scrollbar styling and flex behavior
   - CSS variable fixes (5 undefined variables corrected)
   - Accessibility improvements (focus-visible)
   - HabitatDebug integration

3. **Component Updates**
   - GuineaPigSidebar.vue emoji display (gender-based)
   - HabitatCareSidebar.vue section reordering
   - needsController.ts watcher for decay rate sync
   - autonomySettingsStore.ts threshold updates

**Files to Audit:**
- [ActivityFeedSidebar.vue](../src/components/game/habitat/sidebars/ActivityFeedSidebar.vue) - NEW component
- [ActivityFeed.vue](../src/components/game/ui/ActivityFeed.vue) - Props and external control
- [SubTabContainer.vue](../src/components/layout/SubTabContainer.vue) - Major enhancements
- [GuineaPigSidebar.vue](../src/components/game/habitat/sidebars/GuineaPigSidebar.vue) - Emoji display
- [HabitatCareSidebar.vue](../src/components/game/habitat/sidebars/HabitatCareSidebar.vue) - Section reordering
- [needsController.ts](../src/stores/needsController.ts) - Decay rate sync watcher
- [autonomySettingsStore.ts](../src/stores/autonomySettingsStore.ts) - Threshold updates
- [useGuineaPigBehavior.ts](../src/composables/game/useGuineaPigBehavior.ts) - Priority calculations
- [HabitatDebug.vue](../src/components/debug/environment/HabitatDebug.vue) - Container query, spacing
- [SuppliesStoreDebug.vue](../src/components/debug/environment/SuppliesStoreDebug.vue) - Removed show-status

**Checklist:**
- [ ] Run TypeScript strict mode check
- [ ] Review all `TODO` and `FIXME` comments
- [ ] Check for unused imports and variables
- [ ] Verify error handling in new functions
- [ ] Check for magic numbers (should use constants)
- [ ] Review computed property dependencies
- [ ] Verify reactive updates work correctly
- [ ] Check for memory leaks (intervals, listeners, timeouts)
- [ ] Review new component implementations
- [ ] Check for production console.logs
- [ ] Verify CSS follows BEM methodology
- [ ] Verify logical properties usage
- [ ] Verify CSS variables usage (no magic colors/sizes)
- [ ] Test new features for edge cases
- [ ] Document code quality issues found
- [ ] Apply fixes for critical/medium issues

**Audit Document:** üìã To be created: [CODE-AUDIT-2025-11-10.md](audits/CODE-AUDIT-2025-11-10.md)

---

### CSS Audit & Consistency Check
**Priority:** HIGH
**Status:** üìã Not Started
**Category:** Code Quality

**Goal:** Ensure CSS follows project standards and uses utilities where appropriate

**Components to Audit:**
- [ActivityFeedSidebar.vue](../src/components/game/habitat/sidebars/ActivityFeedSidebar.vue) - NEW
- [ActivityFeed.vue](../src/components/game/ui/ActivityFeed.vue) - Modified
- [SubTabContainer.vue](../src/components/layout/SubTabContainer.vue) - Modified
- [GuineaPigSidebar.vue](../src/components/game/habitat/sidebars/GuineaPigSidebar.vue) - Modified
- [HabitatDebug.vue](../src/components/debug/environment/HabitatDebug.vue) - Modified

**Checklist:**
- [ ] No inline styles (use utility classes)
- [ ] BEM naming convention followed
- [ ] Logical properties used (margin-inline, etc.)
- [ ] CSS variables used for spacing/colors
- [ ] No !important flags (unless absolutely necessary)
- [ ] Mobile-first media queries
- [ ] Container queries used where appropriate
- [ ] Accessibility support (prefers-reduced-motion, etc.)

**Audit Document:** üìã To be created: [CSS-AUDIT-GPS2-45.md](audits/CSS-AUDIT-GPS2-45.md)

---

## üêõ **Critical Bug Fixes**

### SubTab Navigation Selection Bug
**Priority:** CRITICAL
**Status:** üìã Not Started
**Category:** Bug Fix

**Issue:**
- **Desktop:** Need to click subtab nav item twice for selected state to stick (content switches immediately on first click)
- **Touch:** Selected state never appears, though content switches correctly
- **On Load:** First subtab nav item is selected, but deselects when touching different item and never appears again

**Investigation Needed:**
- Check click/touch event handlers in SubTabContainer.vue
- Review active state management and CSS
- Verify v-model binding and state updates
- Test hover states vs active states

**Files to Check:**
- [SubTabContainer.vue](../src/components/layout/SubTabContainer.vue) - Event handlers and state management

---

### Simultaneous Poop Bug
**Priority:** HIGH
**Status:** üìã Not Started
**Category:** Bug Fix

**Issue:** Multiple guinea pigs pooping at the exact same time (easier to track now with visible poop panel)

**Investigation Needed:**
- Review poop timing logic
- Check for race conditions in poop generation
- Verify individual guinea pig timers vs shared timers
- Add randomization to prevent simultaneous events

**Files to Check:**
- Poop generation logic (likely in guinea pig behavior or needs system)

---

### Clean Habitat Not Restoring Bedding Freshness
**Priority:** HIGH
**Status:** üìã Not Started
**Category:** Bug Fix

**Issue:** When cleaning habitat, bedding freshness is not set back to 100%. It should set both cleanliness AND bedding freshness to 100% (soiled bedding removed and replaced).

**Solution:**
- Update `cleanCage()` function to set both cleanliness and bedding freshness to 100%
- Document the behavior change

**Files to Modify:**
- [habitatConditions.ts](../src/stores/habitatConditions.ts) - cleanCage function

---

## üéØ **Feature Additions**

### Quick Clean Button
**Priority:** MEDIUM
**Status:** üìã Not Started
**Category:** Feature Enhancement

**Goal:** Add "Quick Clean" button that removes poop without using bedding or showing bedding dialog

**Requirements:**
- New button in HabitatCareSidebar.vue
- Only removes poop from habitat
- Does not consume bedding
- Does not show Clean Habitat dialog
- Quick action for maintaining habitat between full cleans

**Files to Modify:**
- [HabitatCareSidebar.vue](../src/components/game/habitat/sidebars/HabitatCareSidebar.vue) - Add button
- [habitatConditions.ts](../src/stores/habitatConditions.ts) - Add quickClean function
- [HabitatDebug.vue](../src/components/debug/environment/HabitatDebug.vue) - Wire up handler

---

### Care Action Buttons Pause State
**Priority:** MEDIUM
**Status:** üìã Not Started
**Category:** UX Enhancement

**Goal:** Disable care action buttons when game is paused

**Requirements:**
- Check game pause state in HabitatCareSidebar.vue
- Disable Clean Habitat, Refill Water, Fill Hay Racks buttons when paused
- Add tooltip explaining why disabled

**Files to Modify:**
- [HabitatCareSidebar.vue](../src/components/game/habitat/sidebars/HabitatCareSidebar.vue)

---

### Click Guinea Pig to Select in Sidebar
**Priority:** MEDIUM
**Status:** üìã Not Started
**Category:** UX Enhancement

**Goal:** When clicking on a guinea pig in the habitat, automatically switch to the Guinea Pig sidebar panel and select that guinea pig

**Requirements:**
- Add click handler to GuineaPigSprite.vue
- Update selectedGuineaPigId in store
- Switch active sidebar to 'socialize' (Guinea Pig panel)
- Ensure sidebar updates reactively to show clicked guinea pig

**Files to Modify:**
- [GuineaPigSprite.vue](../src/components/game/habitat/GuineaPigSprite.vue) - Add click handler
- [guineaPigStore.ts](../src/stores/guineaPigStore.ts) - Update selection state
- [HabitatDebug.vue](../src/components/debug/environment/HabitatDebug.vue) - Handle sidebar switching

---

### Touch Device Inventory Placement
**Priority:** MEDIUM
**Status:** üìã Not Started
**Category:** UX Enhancement

**Goal:** Enable inventory item placement on touch devices

**Current Issue:** Drag conflicts with page scrolling on mobile/tablets

**Solution - Grid Cell Selection:**
- Detect touch devices
- Disable drag-and-drop on touch
- Add X/Y select dropdowns for grid cell selection
- Highlight selected grid cell
- Add "Place Item" button (enabled when valid cell selected)
- Place item when button clicked

**Requirements:**
- Touch detection utility
- Grid cell select UI
- Cell highlighting
- Validation for placement
- Place button with disabled states

**Files to Modify:**
- [InventorySidebar.vue](../src/components/game/habitat/sidebars/InventorySidebar.vue) - Touch UI
- [HabitatVisual.vue](../src/components/game/habitat/HabitatVisual.vue) - Cell selection/highlighting

---

## üéØ **Phase 5 Implementation (Continued)**

**Status:** üöß In Progress - System 22 Component 1 Complete

### System 22 Component 2: Guinea Pig Rescue System
**Priority:** HIGH
**Status:** üìã Not Started
**Category:** Phase 5 Implementation

**Goal:** Implement safety net system to prevent guinea pig death/severe neglect

**Components:**
1. **Wellness Monitoring:** Track when wellness drops below critical thresholds
2. **Auto-Intervention:** Automatically trigger basic care when critical
3. **Player Notification:** Inform player of auto-care actions taken
4. **Resource Management:** Auto-consume inventory items for rescue care

**Documentation:** [System 22 Component 2](systems/phase5/system-22-interaction-enhancement.md#component-2-guinea-pig-rescue-system)

---

### System 22 Component 3: Enhanced Activity Messages
**Priority:** HIGH
**Status:** üìã Not Started
**Category:** Phase 5 Implementation

**Goal:** Expand activity feed and chat bubbles with richer, more descriptive messages

**Components:**
1. **Contextual Messages:** Messages that reference current needs/wellness state
2. **Personality-Based Variation:** Different message styles based on personality
3. **Milestone Messages:** Special messages for friendship/wellness milestones
4. **Environmental Context:** Messages that reference habitat state
5. **Specialized Interaction Reactions:** More specific, contextual responses for each interaction type
   - "Sing To" ‚Üí "My favorite song!", "I love when you sing!", "‚ô™‚ô´ Beautiful! ‚ô´‚ô™"
   - "Talk To" ‚Üí More conversational responses
   - "Peek-a-Boo" ‚Üí Playful surprise responses
   - "Show Toy" ‚Üí Excitement about specific toys

**Files to Modify:**
- [guineaPigMessages.ts](../src/data/guineaPigMessages.ts) - Expand all message categories

**Documentation:** [System 22 Component 3](systems/phase5/system-22-interaction-enhancement.md#component-3-enhanced-activity-messages)

---

### Remaining Phase 5 Systems

After completing System 22, continue with:

1. **System 23:** [Enrichment & Resource Management System](systems/phase5/system-23-enrichment-resource-management.md)
2. **System 23.5:** [Fulfillment Limitation System](systems/phase5/system-23.5-fulfillment-limitation.md)
3. **System 24:** Progression & Economy System
4. **System 25:** Game Tutorial System
5. **System 26:** Performance Mode System
6. **System 27:** Sound System
7. **System 28:** Settings & Preferences System
8. **System 29:** Guinea Pig Animation System

---

### Interaction Rejection Logic & Messaging
**Priority:** HIGH
**Status:** üìã Not Started
**Category:** Bug Fix + Game Balance

**Issues:**
1. Guinea pig rejects interaction but chat bubble shows positive message
2. Rejection due to "low wellness" but wellness appears fine
3. Rejection logic unclear and inconsistent

**Solution - Three-Factor Rejection System:**

**1. Personality-Based Friendship Growth:**
- **Not Friendly / Not Bold guinea pigs:**
  - Friendship grows slower
  - Need more time and gentler interactions to increase friendship
  - Initially reject pets and holding
  - Accept gentler interactions first
- **Friendly / Bold guinea pigs:**
  - Accept pets and holding immediately
  - Faster friendship growth
  - More accepting of all interactions

**2. Wellness-Based Rejection (< 50% wellness):**
- Guinea pig rejects: Pet, Hold (physical interactions)
- Guinea pig ALWAYS accepts: Hand Feed, Gentle Wipe (care interactions)
- Rationale: Sick/uncomfortable guinea pigs don't want to be handled but still need care

**3. Cage Conditions-Based Rejection (< 50% habitat quality):**
- Guinea pig rejects interactions when cage is dirty/uncomfortable
- Poor environment = stressed guinea pig = less accepting

**Additional Behavior Changes:**
- Hiding behavior increases when wellness < 50% or cage conditions < 50%
- Guinea pigs seek shelter/hiding spots more frequently in poor conditions

**Files to Modify:**
- Interaction rejection logic (likely in guineaPigStore.ts or interaction composables)
- Chat bubble message selection (match rejection state)
- Activity feed messaging (ensure consistency)
- Behavior autonomy (increase hiding when stressed)

---

### Chat Bubbles Cut Off by Habitat Overflow
**Priority:** MEDIUM
**Status:** üìã Not Started
**Category:** Visual Bug

**Issue:** Chat bubbles clipped by habitat container overflow settings

**Files to Check:**
- [HabitatVisual.vue](../src/components/game/habitat/HabitatVisual.vue) - Overflow settings
- [GuineaPigSprite.vue](../src/components/game/habitat/GuineaPigSprite.vue) - Z-index

---

### Guinea Pigs Resting on Items Without Interacting
**Priority:** MEDIUM
**Status:** üìã Not Started
**Category:** Behavior Improvement

**Issue:** Guinea pigs stop on items without triggering interactions

**Solution - Auto-Trigger Interaction on Landing:**

**Behavior Changes:**
- **Landing on item = automatic interaction trigger**
- **Toys:** "play with" interaction triggers
- **Chew Items:** "chew" interaction triggers
- **Shelters/Beds:** Casual "hang out" interactions with relaxed messaging:
  - "hangs out in [shelter name]"
  - "relaxes in [bed name]"
  - "chills out on [item]"
  - "rests in [shelter]"

**Benefits:**
- More realistic guinea pig behavior
- Clearer cause-and-effect for player
- Items always feel purposeful
- Eliminates "idle on item" confusion

**Files to Modify:**
- [useGuineaPigBehavior.ts](../src/composables/game/useGuineaPigBehavior.ts) - Landing detection and auto-interaction logic
- Activity feed messaging for casual shelter/bed interactions

---

## üìù **Notes**

### Active Items üöß

**To Start:**
- üìã Code audit of GPS2-45 work
- üìã CSS audit of modified components
- üìã Fix critical bugs (subtab nav, simultaneous poop, Clean Habitat)

**Next Priority:**
- System 22 Component 2: Guinea Pig Rescue System
- System 22 Component 3: Enhanced Activity Messages
- Interaction rejection logic improvements
- Chat bubble overflow fix
- Auto-trigger interactions on item landing

### Next Steps
1. **Run code audit of GPS2-45 branch**
2. **Create audit documents**
3. **Fix critical bugs (subtab nav selection, poop timing, Clean Habitat)**
4. **Implement Quick Clean button**
5. **Continue System 22 Components 2-3**

---

## ‚úÖ **Completed This Sprint**

_(To be filled in as work progresses)_

---

**Previous Sprint Archive:** See [SPRINT-2025-11-04.md](archive/SPRINT-2025-11-04.md) for completed work including:
- Code audit (9.4/10)
- CSS audit (9.8/10)
- System 22 Component 1: Wellness-Based Interaction Reactions
- Activity Feed styling improvements
- SubTab Navigation component enhancements
- Supplies Store cleanup
