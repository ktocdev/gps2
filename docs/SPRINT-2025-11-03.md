# GPS2 Sprint - November 3, 2025

**Started:** November 3, 2025
**Status:** Active ðŸš§
**Branch:** GPS2-42
**Previous Sprint:** [SPRINT-2025-11-02.md](SPRINT-2025-11-02.md)

---

## ðŸŽ¯ **Sprint Goals**

**Focus:** Code audit, Phase 2.5 systems, and high-priority bug fixes

**Priority Areas:**
1. Audit previous sprint's code and CSS for consistency
2. Implement Phase 2.5 systems (Food consumption limits, personality traits)
3. Fix window focus bug affecting autonomous behavior
4. Polish and optimization

---

## ðŸ“‹ **Sprint Backlog**

### Code Audit & Cleanup ðŸ”

#### Audit Previous Sprint Code
**Priority:** HIGH
**Status:** âœ… Completed
**Category:** Code Quality

**Goal:** Review all code from November 2 sprint for consistency, best practices, and potential issues

**Areas to Review:**
1. **Smart Bedding System**
   - Check proportional bedding consumption logic
   - Verify fractional quantity tracking
   - Review dialog UX and error handling

2. **Companion Bond System Updates**
   - Review proximity time tracking and reactivity fixes
   - Check bond strength message calculations
   - Verify bonding rate (+1 per 10 seconds)

3. **Player Friendship Display**
   - Review friendship message logic
   - Check display positioning and styling

4. **Toggle Button Implementation**
   - Review toggle button consistency across panels
   - Verify flex utilities usage

5. **Hand-Feed System**
   - Review food selection dialog
   - Check cooldown system implementation
   - Verify bedding type select truncation fix

**Files to Review:**
- [habitatConditions.ts](../src/stores/habitatConditions.ts)
- [guineaPigStore.ts](../src/stores/guineaPigStore.ts)
- [bondingProgression.ts](../src/utils/bondingProgression.ts)
- [CleanCageDialog.vue](../src/components/game/dialogs/CleanCageDialog.vue)
- [FoodSelectionDialog.vue](../src/components/game/dialogs/FoodSelectionDialog.vue)
- [SocializeSidebar.vue](../src/components/game/habitat/sidebars/SocializeSidebar.vue)
- [HabitatDebug.vue](../src/components/debug/environment/HabitatDebug.vue)
- [AutonomyDebug.vue](../src/components/debug/environment/AutonomyDebug.vue)

**Checklist:**
- [x] Run TypeScript strict mode check âœ… Build passes
- [x] Review all `TODO` and `FIXME` comments âœ… Only 3 found, all future features
- [x] Check for unused imports and variables âœ… None found
- [x] Verify error handling in new functions âœ… All have proper guards and returns
- [x] Check for magic numbers (should use constants) âœ… Fixed water consumption constants
- [x] Review computed property dependencies âœ… All properly defined
- [x] Verify reactive updates work correctly âœ… Map recreation pattern used correctly
- [x] Check for memory leaks (intervals, listeners) âœ… None found

**Code Quality Issues Fixed:**
1. **habitatConditions.ts** - Replaced magic numbers (5, 10, 15) with `CONSUMPTION.WATER_MINIMUM_LEVEL`, `WATER_CONSUMPTION_MIN`, `WATER_CONSUMPTION_MAX`
2. **guineaPigStore.ts** - Fixed parameter name `hoursToAdd` â†’ `minutesToAdd` to match actual usage
3. **supplies.ts** - Added water consumption constants to centralized config

**Performance & Efficiency Fixes:**
1. **ðŸ”´ CRITICAL: SocializeSidebar.vue** - Fixed memory leak where `setInterval` created new Map every second
   - **Before:** `interactionCooldowns.value = new Map(interactionCooldowns.value)` every 1000ms
   - **After:** Interval only runs when cooldown active, auto-stops when expired
   - **Impact:** Eliminates unnecessary re-renders and Map allocations

2. **friendshipMessages.ts** - Extracted duplicate functions (38 lines â†’ shared utility)
   - Removed duplicate `getBondStrengthMessage()` and `getPlayerFriendshipMessage()`
   - Created shared utility with threshold-based lookup
   - **Impact:** DRY principle, easier to maintain message thresholds

3. **guineaPigStore.ts** - Added `getBondsForGuineaPig(id)` optimized method
   - **Before:** `getAllBonds().filter(bond => ...)` - O(n) get all + O(n) filter
   - **After:** Direct iteration with early returns - O(n) single pass
   - **Impact:** Faster bond lookups for UI rendering

4. **bondingProgression.ts** - Cached store instances at module level
   - **Before:** Called `useGuineaPigStore()` etc. every game tick per bond
   - **After:** Cached once at module load
   - **Impact:** Eliminates repeated store initialization overhead

5. **FoodSelectionDialog.vue** - Optimized filtering logic
   - **Before:** `.map().filter()` - created objects then discarded them
   - **After:** Check quantity first, only create objects for items with stock
   - **Impact:** Fewer object allocations, faster filtering

6. **CleanCageDialog.vue** - Removed `!important` flag, used specificity instead
   - Changed `.text-warning` to `.bedding-info__value.text-warning`
   - **Impact:** Better CSS maintainability, follows BEM standards

**Verified Working:**
- Smart bedding system with proportional consumption
- Bond proximity time tracking with reactivity
- Fractional quantity tracking (amountRemaining)
- Error handling in cleanCage() function
- Food selection dialog with category filtering
- All performance optimizations pass TypeScript strict mode

---

#### CSS Audit & Consistency Check
**Priority:** HIGH
**Status:** ðŸ“‹ Not Started
**Category:** Code Quality

**Goal:** Ensure CSS follows project standards and uses utilities where appropriate

**Areas to Review:**
1. Check for inline styles (should use utilities)
2. Verify BEM naming consistency
3. Check for duplicate styles
4. Ensure logical properties are used (not physical)
5. Verify mobile-first responsive design
6. Check for hardcoded values (should use CSS variables)
7. Review container query usage

**Files to Review:**
- [CleanCageDialog.vue](../src/components/game/dialogs/CleanCageDialog.vue)
- [FoodSelectionDialog.vue](../src/components/game/dialogs/FoodSelectionDialog.vue)
- [SocializeSidebar.vue](../src/components/game/habitat/sidebars/SocializeSidebar.vue)
- Any other files modified in previous sprint

**Checklist:**
- [ ] No inline styles (use utility classes)
- [ ] BEM naming convention followed
- [ ] Logical properties used (margin-inline, etc.)
- [ ] CSS variables used for spacing/colors
- [ ] No !important flags (unless absolutely necessary)
- [ ] Mobile-first media queries
- [ ] Container queries used where appropriate

---

### High Priority Bugs ðŸ”¥

#### Guinea Pigs Stop Autonomous Behavior When Window Loses Focus
**Priority:** HIGH
**Status:** ðŸ“‹ Not Started
**Category:** Core Gameplay

**Issue:** When the game is running but user switches to a different program, guinea pigs fail to fulfill their needs or do any other autonomous actions (pooping still works).

**Possible Cause:** Browser throttling requestAnimationFrame when window not focused.

**Potential Solutions:**
1. Switch from requestAnimationFrame to setInterval for autonomous behavior
2. Use Page Visibility API to detect when tab loses focus
3. Accumulate time while unfocused and "catch up" when refocused
4. Use Web Workers for autonomous behavior (more complex)

**Files to Investigate:**
- [gameTimingStore.ts](../src/stores/gameTimingStore.ts) - Main game loop
- [useGuineaPigBehavior.ts](../src/composables/game/useGuineaPigBehavior.ts) - Autonomous behaviors

---

## âš™ï¸ **Phase 2.5 Systems**

**Note:** These systems were deferred during Phase 4 development and need to be implemented before Phase 5.

### System 10.1: Personality Trait Influences on Interactions
**Priority:** HIGH
**Status:** ðŸ“‹ Not Started
**Category:** Social System Enhancement

**Documentation:** [System 10.1](systems/phase2.5/system-10.1-personality-influences.md)

**Goal:** Personality traits affect how guinea pigs respond to player interactions

**Key Features:**
- Shy guinea pigs: lower acceptance rate for handling/play
- Bold guinea pigs: higher acceptance rate, more eager
- Calm guinea pigs: longer tolerance for interactions
- Energetic guinea pigs: prefer active interactions (play > petting)

---

### System 10.2.5: Fulfillment Limitation System
**Priority:** HIGH
**Status:** ðŸ“‹ Not Started
**Category:** Food & Wellness System

**Documentation:** [System 10.2.5](systems/phase2.5/system-10.2.5-fulfillment-limitation.md)

**Goal:** Limit food consumption per hunger cycle to prevent spam feeding

**Key Features:**
- 5 servings max per hunger cycle (excludes hay)
- Hay unlimited (always available)
- Prevents overfeeding exploits
- More realistic feeding patterns

**Includes:** Food Serving Guide UI component (see documentation)

---

### System 10.3: Wellness-Based Interaction Reactions
**Priority:** HIGH
**Status:** ðŸ“‹ Not Started
**Category:** Social System Enhancement

**Documentation:** [System 10.3](systems/phase2.5/system-10.3-wellness-reactions.md)

**Goal:** Guinea pig wellness affects interaction acceptance rates

**Key Features:**
- High wellness (>70): more accepting, lower rejection rate
- Low wellness (<30): more rejections, needs rest/care
- Creates gameplay loop: good care â†’ better interactions â†’ higher friendship

---

## ðŸŽ¯ **Future Sprints - Planned Work**

These items are planned for future sprints and are not part of the current sprint scope.

### Social Interaction Enhancements ðŸ¤

#### Multi-Type Guinea Pig Interactions
**Priority:** LOW (Phase 5+)
**Status:** ðŸ“‹ Not Started (Future Enhancement)

Expand guinea pig social interactions beyond just "socialize":
- Play Interaction (social + play needs)
- Sniff/Investigate (social only)
- Groom/Allogrooming (social + hygiene)
- Huddle/Cuddle (social + comfort)

---

#### Pushable Toys System
**Priority:** LOW (Phase 5+)
**Status:** ðŸ“‹ Not Started (Future Enhancement)

Guinea pigs physically move balls and pushable toys across grid cells.

---

### Adoption System Enhancement ðŸ¹

#### Pre-Bonded Pairs & Solo Guinea Pigs
**Priority:** HIGH (Future Sprint)
**Status:** ðŸ“‹ Not Started

**Documentation:** See sprint doc for full specification

Implement adoption constraints:
- Bonded pairs must be adopted together
- Solo-suitable guinea pigs can be adopted alone
- Enhanced observation system (3 clues including bonding status)

---

### Testing & Balance ðŸŽ®

#### Gameplay Testing Checklist
**Priority:** HIGH (Future Sprint)
**Status:** ðŸ“‹ Not Started

Comprehensive testing of all systems:
- Needs & wellness system
- Autonomous behaviors
- Food & consumption
- Habitat conditions
- Social bonding
- Item metadata & realism

---

#### Create Realism Guidelines
**Priority:** MEDIUM (Future Sprint)
**Status:** ðŸ“‹ Not Started

Document realistic guinea pig care guidelines for game balance:
- Feeding frequency & amounts
- Sleep patterns
- Social behavior
- Habitat cleanliness standards

---

## ðŸ“ **Notes**

- Previous sprint completed 9 major items including bedding system, bonding improvements, and UI enhancements
- Focus this sprint on quality: audit, cleanup, and Phase 2.5 systems
- Window focus bug is high priority as it affects core gameplay experience
- **Next task:** Update [DEVELOPMENT_PHASES.md](DEVELOPMENT_PHASES.md) and related docs to document this cleanup/audit phase
