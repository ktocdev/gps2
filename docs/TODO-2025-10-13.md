# GPS2 Implementation TODO - October 13, 2025

**Created:** October 13, 2025
**Status:** Phase 2 Complete ✅ - Planning Phase 3 📋
**Branch:** GPS2-24
**Previous:** [TODO-2025-10-05.md](archive/TODO-2025-10-05.md)

---

## 🎉 **Phase 2 Complete!**

### System 6.95: Permanent Adoption & Stardust Sanctuary ✅

All core features implemented and tested:
- ✅ Permanent adoption model (no returns, no sessions)
- ✅ Stardust Sanctuary achievement (85% friendship threshold)
- ✅ Natural store churn (2-5 day adoption timers)
- ✅ Friendship-gated features with 100% wellness freeze
- ✅ Observe interaction with personality glimpses
- ✅ Pet Adoption UI with habitat organization (3-4 per habitat)
- ✅ Paired adoption timers (40% chance, leave together)
- ✅ AdoptionConfirmDialog component
- ✅ InfoButton enhancements and guidance
- ✅ Removed disliked activities and habitats (kept food dislikes)
- ✅ Feeding cycle status panel with manual reset controls

**Documentation:** [System 6.95 Implementation Plan](systems/phase2/system-6.95-REDESIGN-implementation-plan.md)

---

## 🕜 **On Hold - Phase 2.5: Interactive Feedback Enhancements

These updates will be put off until after the habitat is completed.

### Remaining Phase 2.5 Systems

Phase 2.5 enhances gameplay feedback through personality traits, preferences, wellness-based reactions, rescue system, and comprehensive activity messages. These systems build on Phase 2 foundations to create unique, responsive guinea pig personalities.

**Status:** Systems 1 & 2 Complete, System 2.5 Complete - Testing Phase ✅

---

#### **System 3: Wellness-Based Interaction Reactions** 🔜
**Priority:** MEDIUM (uses personality)
**Status:** Not Started

**Goal:** Guinea pigs react differently to interactions based on their wellness level

**Features:**
- Wellness tier system (5 tiers: 80%+, 60-79%, 40-59%, 20-39%, <20%)
- Interaction success rate calculator (95% → 20% based on wellness)
- Behavioral state system (thriving/content/stressed/withdrawn/critical)
- Rejection logic with cooldowns (30-60s)
- Update all interaction methods with wellness checks

**Implementation:**
- Add wellness tier calculation to needsController
- Create behavioral state tracking
- Implement rejection cooldown system
- Update feedGuineaPig, playWithGuineaPig with wellness checks
- Add rejection messages to MessageGenerator

**Files to Update:**
- `src/stores/guineaPigStore.ts` - Add wellness-based reactions
- `src/stores/needsController.ts` - Add behavioral states
- `src/utils/messageGenerator.ts` - Add rejection messages

**Testing Tools:**
- NeedsDebug panel - Adjust wellness/needs to test different tiers
- Activity Feed - Observe interaction success/rejection messages

**Documentation:** [System 3: Wellness-Based Interaction Reactions](systems/phase2.5/system-3-wellness-interaction-reactions.md)

---

#### **System 4: Guinea Pig Rescue System** 🔜
**Priority:** MEDIUM (uses wellness)
**Status:** Not Started

**Goal:** Emergency intervention when guinea pig wellness drops too low

**Features:**
- Rescue detection system (wellness < 15%)
- Rescue action (restore all needs → 100%, $200 penalty)
- Fresh Start option ($1000 reset, lose purchasable slots 4-10, keep 1-3)
- Rescue modal dialogs
- Warning for guinea pigs in slots 4-10
- Rescue threshold adjustment for testing

**Implementation:**
- Create rescue detection in needsController
- Implement rescue action with currency penalty
- Build Fresh Start with slot reset
- Create RescueDialog and FreshStartDialog components
- Add rescue controls to NeedsDebug panel
- Integrate with Stardust Sanctuary (sanctuary guinea pigs unaffected)

**Files to Update:**
- `src/stores/needsController.ts` - Add rescue detection
- `src/stores/playerProgression.ts` - Add Fresh Start
- `src/components/debug/NeedsDebug.vue` - Add rescue controls

**Files to Create:**
- `src/components/dialogs/RescueDialog.vue`
- `src/components/dialogs/FreshStartDialog.vue`

**Note:** Integration with Stardust Sanctuary documented in [system-4-guinea-pig-rescue.md](systems/phase2.5/system-4-guinea-pig-rescue.md) - sanctuary guinea pigs remain unaffected by rescue

**Documentation:** [System 4: Guinea Pig Rescue](systems/phase2.5/system-4-guinea-pig-rescue.md)

---

#### **System 5: Enhanced Activity Messages** 🔜
**Priority:** LOW (uses all systems)
**Status:** Not Started

**Goal:** Rich, contextual messages that make the game feel alive

**Features:**
- Need warning system (20-30% warning, <15% critical)
- Throttling system (60s warnings, 30s critical)
- Wellness-based activity messages (4 wellness ranges)
- Like/dislike clue messages (subtle hints about preferences)
- Friendship milestone tracking (6 tiers: 0-10%, 10-30%, 30-50%, 50-70%, 70-85%, 85%+)
- Guinea pig reaction messages to all interactions

**Implementation:**
- Create warning detection in needsController
- Implement message throttling system
- Add wellness-based message templates
- Create preference clue messages
- Implement milestone tracking and notifications
- Update all interaction methods with reaction messages

**Files to Update:**
- `src/stores/needsController.ts` - Add warning system
- `src/stores/activityFeed.ts` - Add message categories
- `src/utils/messageGenerator.ts` - Add new templates

**Testing Tools:**
- Activity Feed - Observe message throttling, reactions, warnings
- NeedsDebug panel - Test different wellness levels

**Documentation:** [System 5: Enhanced Activity Messages](systems/phase2.5/system-5-enhanced-activity-messages.md)

---

## 📋 **Next Steps - Phase 3: Habitat & Environment**

**Status:** System 13 Foundation Complete ✅ - Restructuring Phase 3 Order 📋

### Phase 3 Architecture Update (October 14, 2025)

Phase 3 has been restructured to follow proper dependency flow: **Supplies Store → Inventory Management → Habitat Integration**

This approach establishes the proper data architecture where:
1. **Supplies Store** defines all purchasable items (catalog, pricing, metadata)
2. **Inventory System** tracks owned items and quantities
3. **Habitat Conditions** consumes inventory resources
4. **Habitat Items** uses inventory for placement
5. **Maintenance** affects conditions and consumes resources

**Updated Documentation:**
- ✅ [DEVELOPMENT_PHASES.md](DEVELOPMENT_PHASES.md) - Phase 3 restructured (Systems 11-15)
- ✅ [PROJECT_PLAN.md](PROJECT_PLAN.md) - Phase 3 references updated
- ✅ [SYSTEM_INTEGRATION.md](SYSTEM_INTEGRATION.md) - Supplies & Inventory dependencies added

---

### Priority Systems for Phase 3 (Restructured Order)

#### **System 11: Supplies Store System** 🔜 **NEXT**
**Priority:** HIGH (foundation for all Phase 3 systems)
**Status:** Not Started

**Goal:** Central catalog of all purchasable items in the game

**Features:**
- **Bedding types** (cheap, average, premium) with absorbency/decay rates
- **Hay varieties** (8 types: Timothy, Orchard Grass, Alfalfa, Meadow, Oat, Botanical, Wheat, Mixed) with nutritional profiles
- **Food items** (vegetables, fruits, pellets, treats) with hunger satisfaction values
- **Habitat items** (hideaways, toys, water bottles, food bowls) with durability and happiness values
- **Item metadata** (name, description, price, category, stats)
- **Availability system** (always available, seasonal, limited stock)

**Implementation:**
- Create `src/stores/suppliesStore.ts` with item catalog
- Define item categories and types (TypeScript interfaces)
- Implement pricing structure and cost balancing
- Create item lookup functions by ID/category
- Build SuppliesStoreDebug panel for testing

**Files to Create:**
- `src/stores/suppliesStore.ts` - Main supplies catalog store
- `src/types/supplies.ts` - TypeScript interfaces for items
- `src/components/debug/SuppliesStoreDebug.vue` - Debug panel

**Integration Points:**
- → Inventory Store (provides purchasable items)
- → Player Progression (currency for purchases)
- → Habitat Conditions (bedding/hay stats)
- → Needs Controller (food stats)

**Documentation:** Will reference [Phase 3 System Docs](systems/phase3/)

---

#### **System 12: Inventory Management System** 🔜
**Priority:** HIGH (depends on Supplies Store)
**Status:** Not Started

**Goal:** Track owned items, quantities, and consumption across all game systems

**Features:**
- **Item ownership tracking** by item ID and quantity
- **Category organization** (bedding, hay, food, habitat items)
- **Consumption tracking** and depletion logic
- **Purchase system** integration with Supplies Store
- **Item usage validation** (do you own enough to use it?)
- **Persistent storage** across game sessions

**Implementation:**
- Create `src/stores/inventoryStore.ts` with ownership tracking
- Implement purchase functions (buy from Supplies Store)
- Create consumption functions (use/consume items)
- Add quantity validation helpers
- Expand InventoryDebug panel (currency controls exist from Phase 2)

**Files to Create:**
- `src/stores/inventoryStore.ts` - Main inventory management
- Expand `src/components/debug/InventoryDebug.vue` - Add item management UI

**Integration Points:**
- ← Supplies Store (item catalog, pricing)
- → Habitat Conditions (bedding/hay consumption)
- → Needs Controller (food consumption)
- → Habitat Item System (placed items)
- ← Player Progression (persistent item ownership)

---

#### **System 13: Habitat Conditions Store** ✅ **FOUNDATION COMPLETE**
**Priority:** HIGH (foundation implemented, awaiting integration)
**Status:** ✅ Foundation Complete (October 14, 2025 | Branch: GPS2-25)

**Goal:** Environmental condition tracking consuming inventory resources

**Completed Features:**
- ✅ Cleanliness tracking (0-100%, decay over time)
- ✅ Bedding freshness (quality: cheap/average/premium, absorbency, decay rate)
- ✅ Hay freshness (current bag with handfuls remaining, unlimited capacity)
- ✅ Water level (0-100%, refill system)
- ✅ Resource management actions (change bedding, refill hay, refill water, clean habitat)
- ✅ Free resources mode for testing
- ✅ Condition history tracking
- ✅ Reset to 100% on new game session
- ✅ HabitatDebug panel with responsive two-column layout

**HabitatDebug Panel Features:**
- ✅ No guinea pigs warning pattern
- ✅ Habitat Conditions panel (4 stat displays)
- ✅ Resource Management panel with Select dropdowns for bedding/hay switching
- ✅ Preview stats display (shows selected item stats before clicking "Use")
- ✅ Bedding Inventory panel with "+" add buttons
- ✅ Hay Inventory panel with handfuls tracking
- ✅ Disabled select options when out of stock (unless free resources mode)
- ✅ Stock count display in select option labels

**Pending Integration:**
- [ ] Connect to Supplies Store for bedding/hay metadata (currently hardcoded stats)
- [ ] Connect to Inventory Store for actual ownership tracking (currently mock inventory)
- [ ] Implement real consumption that depletes inventory
- [ ] Add purchase flow from Supplies Store → Inventory → Habitat usage

**Files Completed:**
- ✅ `src/stores/habitatConditions.ts` - Full implementation with mock data
- ✅ `src/components/debug/HabitatDebug.vue` - Complete UI with preview stats
- ✅ `src/components/basic/Select.vue` - Enhanced with disabled options support

**Documentation:** [System 11: Habitat Conditions](systems/phase3/system-11-habitat-conditions.md)

---

#### **System 14: Habitat Item System** 🔜
**Goal:** Physical items guinea pigs interact with, placed from inventory

**Items:**
- Hideaways (igloos, tunnels, tents)
- Food bowls and water bottles
- Toys (tunnels, balls, chew toys)
- Enrichment items

**Implementation:**
- Item placement system using Inventory data
- Placement and interaction system
- Preference-based item usage
- Item condition decay

**Integration Points:**
- ← Inventory Store (placed items must be owned)
- ← Supplies Store (item stats and metadata)

---

#### **System 15: Habitat Maintenance & Hygiene System** 🔜
**Goal:** Regular care and cleaning tasks affecting habitat conditions

**Tasks:**
- Spot cleaning (remove waste)
- Deep cleaning (full habitat clean)
- Bedding changes
- Water bottle refills
- Food bowl restocking

**Implementation:**
- Task scheduling system
- Visual dirt/mess indicators
- Impact on Habitat Conditions (cleanliness, bedding freshness)
- Time-based task completion

**Integration Points:**
- → Habitat Conditions Store (affects cleanliness, freshness)
- → Inventory Store (consumes cleaning supplies)

---

## Feeding System Realism Enhancements

⚠️ Note: This will be built into the Inventory and Habitat System. 

**Goal:** Add realistic eating behaviors with timing and partial consumption

**Features to Add:**
- **Eating Duration:** Different foods take different times to eat
  - Hay: 10+ seconds (grazing behavior), may leave leftovers
  - Leafy greens (lettuce, kale): 5-8 seconds, partial eating/grazing
  - Crunchy vegetables (carrot, pepper): 8-12 seconds, may nibble and leave
  - Fruits: 3-5 seconds, consumed completely
  - Treats: 2-3 seconds, consumed completely
  - Pellets: 5-8 seconds, consumed completely

- **Partial Consumption:**
  - Hay: Guinea pig may eat 30-70% and leave rest
  - Leafy vegetables: May eat 50-100% depending on preference
  - Root vegetables: May nibble and return multiple times
  - Track "leftover food" that can be eaten later

- **Eating Animations/Status:**
  - Show "Eating [food]..." status during consumption
  - Visual feedback in activity feed with progress
  - Eating sound/behavior indicators

- **Realistic Feeding Mechanics:**
  - Guinea pigs don't eat if not hungry enough (< 30% hunger?)
  - Favorite foods more likely to be eaten completely
  - Disliked foods may be rejected or partially eaten
  - Multiple guinea pigs can eat at the same time

**Implementation Notes:**
- Add `eatingState` to guinea pig (food being eaten, start time, duration)
- Create eating timer system in needsController
- Update feedGuineaPig to start eating timer instead of instant satisfaction
- Add eating completion callback to apply hunger satisfaction
- Track partial food items in habitat/inventory
- Create "Eating Status" display in debug panels

**Files to Update:**
- `src/stores/guineaPigStore.ts` - Add eating state tracking
- `src/stores/needsController.ts` - Add eating timer logic
- `src/components/debug/FeedingDebug.vue` - Show eating status
- `src/utils/messageGenerator.ts` - Add eating progress messages

---

## 🔧 **Technical Debt & Polish**

### Code Cleanup
- [x] Review and consolidate debug panel styles
- [x] Audit unused imports across components
- [x] Remove any remaining legacy favorites references in comments
- [ ] Standardize error handling patterns

### UI/UX Improvements
- [ ] Add loading states for long operations
- [ ] Improve mobile responsiveness for debug panels
- [ ] Add keyboard shortcuts for common debug actions
- [x] Enhance visual feedback for disabled buttons

### Documentation
- [x] Update architecture diagrams for Phase 2 changes
- [x] Document state management patterns
- [ ] Create component library reference
- [ ] Add inline JSDoc comments for complex functions

---

## 📝 **Notes**

### Recent Changes (Phase 7 - October 13)
- Changed "Cage" terminology to "Habitat" throughout Pet Adoption UI
- Changed "Pet Store" to "Pet Adoption" in main heading
- Added InfoButton to Stardust Sanctuary with feature description
- Increased InfoButton popover width (300px default, 400px max)
- Added Feeding Cycle Status panel showing hunger progress and manual reset controls
- Removed disliked activities and habitats from preference system (kept food dislikes)
- Updated all affected components, stores, and message generators

### Property Name Considerations
Note: `cageNumber` property name remains in code for data compatibility, only UI labels use "habitat"

### System Integration
All Phase 2 systems are fully integrated:
- Friendship system with passive gain/loss
- Needs system with personality modifiers
- Preferences with food/activity favorites
- Consumption limits with hunger cycles
- Stardust Sanctuary with 85% threshold
- Permanent adoption with natural churn

---

## 🎮 **Testing Checklist**

### Pre-Phase 3 Testing
- [ ] Test full adoption flow with observe interaction
- [ ] Verify paired guinea pigs leave store together
- [ ] Test Stardust Sanctuary unlock at 85% friendship
- [ ] Verify consumption limits reset at 100% hunger
- [ ] Test preference system (favorites, dislikes, rejection)
- [ ] Verify habitat grouping displays correctly
- [ ] Test InfoButton tooltips across all panels

### Integration Testing
- [ ] Test multiple guinea pigs with different personalities
- [ ] Verify friendship gain/loss calculations
- [ ] Test edge cases (0% friendship, 100% friendship)
- [ ] Verify adoption timer expiration and store updates
- [ ] Test manual consumption limit resets

---

## 🚀 **Commands**

**Development:**
- `npm run dev` - Start development server
- `npm run build` - Production build (run before commits)
- `npm run preview` - Preview production build

**Git:**
- Current branch: `GPS2-24`
- Main branch: `main`

---

## 📚 **Documentation Links**

- [Project Plan](PROJECT_PLAN.md)
- [Development Phases](DEVELOPMENT_PHASES.md)
- [System Integration](SYSTEM_INTEGRATION.md)
- [Phase 2 Systems](systems/phase2/)
- [Phase 2.5 Systems](systems/phase2.5/)
- [System 6.95 Implementation](systems/phase2/system-6.95-REDESIGN-implementation-plan.md)
