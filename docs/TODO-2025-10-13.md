# GPS2 Implementation TODO - October 13, 2025

**Created:** October 13, 2025
**Updated:** October 19, 2025
**Status:** Phase 3 Near Complete âœ… - Preparing for Phase 4 Autonomy ðŸ”œ
**Branch:** GPS2-29
**Previous:** [TODO-2025-10-05.md](archive/TODO-2025-10-05.md)

---

## ðŸŽ‰ **Phase 2 Complete!**

### System 6.95: Permanent Adoption & Stardust Sanctuary âœ…

All core features implemented and tested:
- âœ… Permanent adoption model (no returns, no sessions)
- âœ… Stardust Sanctuary achievement (85% friendship threshold)
- âœ… Natural store churn (2-5 day adoption timers)
- âœ… Friendship-gated features with 100% wellness freeze
- âœ… Observe interaction with personality glimpses
- âœ… Pet Adoption UI with habitat organization (3-4 per habitat)
- âœ… Paired adoption timers (40% chance, leave together)
- âœ… AdoptionConfirmDialog component
- âœ… InfoButton enhancements and guidance
- âœ… Removed disliked activities and habitats (kept food dislikes)
- âœ… ~~Feeding cycle status panel with manual reset controls~~ (removed - integrated into needs system)

**Documentation:** [System 6.95 Implementation Plan](systems/phase2/system-6.95.1-implementation-plan.md)

---

## ðŸ“‹ **Phase 2.5: Interactive Feedback Enhancement** (Deferred)

**Status:** On Hold - Will resume after Phase 3 completion

Phase 2.5 systems (wellness reactions, rescue system, enhanced messages) deferred to focus on habitat environment systems.

**Pending Systems:**
- System 3: Wellness-Based Interaction Reactions
- System 4: Guinea Pig Rescue System
- System 5: Enhanced Activity Messages

**Documentation:** [Phase 2.5 Systems](systems/phase2.5/)

---

## ðŸ“‹ **Phase 3: Habitat & Environment**

**Status:** Core Systems Complete âœ… - Autonomy Prep Items Remaining ðŸ”œ

### Phase 3 Progress Summary

Phase 3 core systems implemented following proper dependency flow:
1. âœ… **Supplies Store** - 104+ item catalog with metadata
2. âœ… **Inventory Management** - Instance-based tracking with sell-back
3. âœ… **Habitat Conditions** - Resource consumption and environmental tracking
4. âœ… **Habitat UI** - Visual grid with drag-and-drop (Phases 1-2)
5. âœ… **Serving System** - Hay rack and food bowl with serving-based inventory
6. âœ… **Maintenance** - Poop tracking, cleanliness, bedding, water

**Remaining:** Water consumption, item type metadata, decay systems, position tracking, usage history

---

### Completed Phase 3 Systems

#### **System 11: Supplies Store System** âœ… **COMPLETED**
**Priority:** HIGH (foundation for all Phase 3 systems)
**Status:** âœ… **Completed** (October 15, 2025 | Branch: GPS2-26, GPS2-27)

**Goal:** Central catalog of all purchasable items in the game

**Completed Features:**
- âœ… **Bedding types** (cheap, average, premium) with absorbency/decay rates, color varieties
- âœ… **Hay varieties** (8 types: Timothy, Orchard Grass, Alfalfa, Meadow, Oat, Botanical, Wheat, Mixed) with nutritional profiles
- âœ… **Food items** organized by 6 subcategories:
  - Fresh Greens (5 items)
  - Fresh Herbs (4 items)
  - Vegetables (7 items)
  - Fruits (6 items)
  - Pellets (3 tiers: Cheap, Standard, Fortified)
  - Premium Treats (3 items with visual effects & badge unlocks)
- âœ… **Habitat items** (64+ items across 5 subcategories):
  - Hideaways (13): Basic, Tunnels, Premium, Beds
  - Toys (11): Rolling, Interactive, Premium
  - Chews (12): Natural Wood, Shaped, Premium
  - Bowls & Bottles (12): Water bottles, Food bowls, Hay racks
  - Enrichment (16): Platforms, Exploration, Sensory, Premium
- âœ… **Item metadata** (name, description, price, category, stats, quality, tags)
- âœ… **Availability system** (always, seasonal, limited)
- âœ… **Purchase flow integration** (currency deduction, inventory addition)
- âœ… **Reusable SupplyItemCard component** with quantity selector and purchase controls
- âœ… **Sell-back system** (100% refund for unopened/unplaced items)
- âœ… **Starter inventory** (6 essential items given on first guinea pig adoption)

**Total Items:** 104+ unique purchasable items

**Files Created:**
- âœ… `src/stores/suppliesStore.ts` - Main supplies catalog store with 104+ items
- âœ… `src/types/supplies.ts` - TypeScript interfaces for items, inventory, cart, purchase, sell-back
- âœ… `src/stores/inventoryStore.ts` - Instance-based inventory with sell-back restrictions
- âœ… `src/components/debug/SuppliesStoreDebug.vue` - Supplies store debug panel with sell-back UI
- âœ… `src/components/debug/SupplyItemCard.vue` - Reusable item card with sell/buy controls
- âœ… `src/components/debug/InventoryDebug.vue` - Three-column grid inventory display

**Integration Points:**
- âœ… Player Progression (currency for purchases) - Integrated
- âœ… Inventory Store (purchase flow, ownership tracking) - Implemented
- âœ… Pet Store Manager (starter inventory on first adoption) - Integrated
- â†’ Habitat Conditions (bedding/hay consumption) - Ready for integration
- â†’ Needs Controller (food consumption) - Ready for integration

**Documentation:** [System 11: Supplies Store](systems/phase3/system-11-supplies-store.md)

---

#### **System 12: Inventory Management System** âœ… **COMPLETED**
**Priority:** HIGH (depends on Supplies Store)
**Status:** âœ… **Completed** (October 16, 2025 | Branch: GPS2-27)

**Goal:** Track owned items, quantities, and consumption across all game systems

**Completed Features:**
- âœ… **Instance-based tracking** - Each item is a unique instance with individual state
- âœ… **Item state tracking** - Track opened/unopened bags, placed/unplaced habitat items
- âœ… **Sell-back system** - 100% refund for returnable items with restrictions:
  - Cannot return opened bags of hay or bedding
  - Cannot return items placed in habitat
  - Otherwise items can be sold back for full price
- âœ… **Category organization** - Consumables (bedding, hay, food) and Habitat Items
- âœ… **Starter inventory** - New players receive 6 essential items on first adoption:
  - 1Ã— Timothy Hay
  - 1Ã— Average Bedding
  - 1Ã— Standard Pellets
  - 1Ã— Green Leaf Lettuce
  - 1Ã— Carrot
  - 1Ã— Apple Wood Sticks
- âœ… **Debug controls** - Mark items as opened/placed for testing sell-back restrictions
- âœ… **Data migration** - Automatic migration from old quantity-based to instance-based format
- âœ… **Three-column responsive grid** - Mobile-first design (1/2/3 columns)
- âœ… **Inventory card design** - Gradient backgrounds, distinct from store cards
- âœ… **Navigation organization** - Inventory moved to Environment Systems dropdown

**Instance-Based System:**
- Each item has unique `instanceId` for individual tracking
- Separate counts for opened/unopened, placed/unplaced items
- "Open One" button marks single instance as opened
- "Place One" / "Remove One" buttons for habitat item placement
- Returnable quantity shows items eligible for sell-back

**Files Completed:**
- âœ… `src/stores/inventoryStore.ts` - Full instance-based implementation
- âœ… `src/types/supplies.ts` - ItemInstance interface with state tracking
- âœ… `src/components/debug/InventoryDebug.vue` - Redesigned with grid layout
- âœ… `src/components/debug/SupplyItemCard.vue` - Sell-back UI integration
- âœ… `src/stores/petStoreManager.ts` - Starter inventory integration

**Integration Points:**
- âœ… Supplies Store (item catalog, pricing) - Fully integrated
- âœ… Player Progression (currency for sell-back refunds) - Integrated
- âœ… Pet Store Manager (starter inventory on adoption) - Integrated
- âœ… Habitat Conditions (bedding/hay consumption) - Fully integrated
- âœ… Habitat Item System (placement tracking) - Fully integrated
- â†’ Needs Controller (food consumption) - Ready for integration

---

#### **System 13: Habitat Conditions Store** âœ… **COMPLETED**
**Priority:** HIGH (fully integrated with Supplies & Inventory)
**Status:** âœ… **Completed** (October 16, 2025 | Branch: GPS2-27)

**Goal:** Environmental condition tracking consuming inventory resources

**Completed Features:**
- âœ… Cleanliness tracking (0-100%, decay over time)
- âœ… Bedding freshness (quality-based: cheap/average/premium with absorbency/decay from Supplies Store)
- âœ… Hay freshness (bag tracking with 20 handfuls per bag, auto-refill from inventory)
- âœ… Water level (0-100%, refill system)
- âœ… Resource management actions (clean cage, refresh bedding, refill hay, refill water, give hay handful)
- âœ… Condition history tracking
- âœ… Reset to 100% on new game session
- âœ… **Habitat Items Tracking** - Track items placed IN habitat separately from inventory
- âœ… **Starter Habitat Items** - 4 items placed in habitat on first adoption (water bottle, igloo, bowl, hay rack)
- âœ… **Migration-free implementation** - Removed all backward compatibility code

**HabitatDebug Panel Features:**
- âœ… No guinea pigs warning pattern
- âœ… Full-width Habitat Conditions panel with integrated controls
- âœ… Bedding/Hay type selects integrated directly into condition items
- âœ… Dynamic condition summary with themed gradients (green/yellow/red based on overall condition)
- âœ… Smart hay handful system (auto-opens new bag when current bag is empty)
- âœ… Stock count display in select option labels
- âœ… **Habitat Items Panel (FPO)** - Grid display of items currently in habitat
- âœ… **Move to Inventory** - Remove items from habitat back to inventory

**Supplies Store Integration:**
- âœ… Bedding metadata pulled from Supplies Store (absorbency, decay rate)
- âœ… Hay metadata pulled from Supplies Store (8 types available)
- âœ… Habitat items metadata (water bottles, bowls, igloo, hay rack)
- âœ… All item stats sourced from central catalog

**Inventory Integration:**
- âœ… Real consumption depletes inventory (marks items as opened/used)
- âœ… Bedding refresh consumes 1 bedding bag from inventory
- âœ… Hay refill consumes 1 hay bag from inventory (gives 20 handfuls)
- âœ… Handful of hay consumes from current bag (auto-opens new bag if needed)
- âœ… Habitat items marked as "placed" when added to habitat
- âœ… Habitat items unmarked when moved back to inventory

**Habitat Items System:**
- âœ… `habitatItems` ref tracking items currently placed in habitat
- âœ… `addItemToHabitat()` - Move item from inventory to habitat
- âœ… `removeItemFromHabitat()` - Move item from habitat back to inventory
- âœ… `initializeStarterHabitat()` - Set up starter items on first adoption
- âœ… Integration with `markAsPlacedInHabitat()` / `unmarkAsPlacedInHabitat()` in inventory store

**Starter Habitat Setup:**
- âœ… **In Habitat (4 items placed):**
  - Basic Water Bottle
  - Plastic Igloo
  - Basic Ceramic Bowl
  - Basic Hay Rack
- âœ… **In Inventory Only (6 items):**
  - Timothy Hay (unopened bag)
  - Average Bedding (unopened bag)
  - Standard Pellets
  - Green Leaf Lettuce
  - Carrot
  - Apple Wood Sticks

**Files Completed:**
- âœ… `src/stores/habitatConditions.ts` - Full integration with Supplies & Inventory
- âœ… `src/components/debug/HabitatDebug.vue` - Complete UI with Habitat Items panel
- âœ… `src/stores/suppliesStore.ts` - Added `habitat_basic_water_bottle` item
- âœ… `src/stores/petStoreManager.ts` - Starter habitat items integration
- âœ… `src/stores/inventoryStore.ts` - Habitat placement tracking

**Documentation:** [System 13: Habitat Conditions](systems/phase3/system-13-habitat-conditions.md)

---

#### **System 14: Habitat UI & Item Placement System** âœ… **PHASE 1 & 2 COMPLETE**
**Priority:** HIGH
**Status:** âœ… Phases 1-2 Complete (October 17, 2025 | Branch: GPS2-29) | Phase 3 Deferred

**Completed Features:**
- âœ… **Visual Habitat Grid** - 14x10 medium habitat (60px cells)
- âœ… **Subgrid System** - 56x40 subcells for poop/particles
- âœ… **Drag & Drop** - HTML5 native implementation
- âœ… **Item Placement** - Drag from inventory sidebar to habitat
- âœ… **Position Persistence** - itemPositions Map with localStorage
- âœ… **Stacking Support** - Items can overlap with z-index
- âœ… **Repositioning** - Placed items can be dragged to new positions
- âœ… **Constraints** - Water bottles restricted to edges
- âœ… **Visual Feedback** - Green (valid) / Red (invalid) drop zones
- âœ… **Food Bowl System** - Interactive food placement with drag/drop
- âœ… **Hay Rack System** - 4-serving capacity with visual fullness
- âœ… **Serving-Based Inventory** - Consumables track servings independently

**Phase 3 Decision:**
Phase 3 (Guinea Pig Integration) deferred to Phase 4 autonomy system to avoid building temporary systems. Guinea pig sprites will be implemented with full autonomy, pathfinding, and AI decision-making.

**Files Created:**
- âœ… `src/components/game/HabitatVisual.vue`
- âœ… `src/components/game/FoodBowl.vue`
- âœ… `src/components/game/HayRack.vue`
- âœ… `src/components/game/InventoryTileServing.vue`

**Documentation:** [System 14.1: Habitat UI Implementation Plan](systems/phase3/system-14.1-habitat-ui-implementation-plan.md)

---

#### **System 14.2: Hay Rack & Serving System** âœ… **COMPLETE**
**Priority:** HIGH
**Status:** âœ… Complete (October 19, 2025 | Branch: GPS2-29)

**Completed Features:**
- âœ… **Serving Metadata** - servingsRemaining, maxServings tracking
- âœ… **Hay Rack Component** - 4-serving capacity with visual fullness (whiteâ†’gold)
- âœ… **Food Bowl Integration** - Accepts individual servings
- âœ… **Serving-Based Items:**
  - Hay (8 types): 4 servings each
  - Lettuce (3 types): 6 servings each
  - Carrot: 8 servings
  - Pellets (3 types): 10 servings each
- âœ… **Inventory Display** - InventoryTileServing with depletion colors
- âœ… **Drag Validation** - Custom MIME types for category restrictions
- âœ… **Automatic Cleanup** - Depleted items removed from inventory

**Documentation:** [System 14.2: Hay Rack & Serving System](systems/phase3/system-14.2-hay-rack-and-serving-system.md)

---

#### **System 15: Habitat Maintenance & Hygiene** âœ… **COMPLETE**
**Priority:** HIGH
**Status:** âœ… Complete (October 19, 2025 | Branch: GPS2-29)

**Completed Features:**
- âœ… **Poop Tracking** - Grid-based placement and removal
- âœ… **Poop Component** - Click to remove individual poops
- âœ… **Cleanliness Impact** - Each poop reduces cleanliness by 2-5 points
- âœ… **Clean Cage** - Removes all poops, sets cleanliness to 100%
- âœ… **Bedding System** - Already implemented with freshness tracking
- âœ… **Water System** - Already implemented with refill action
- âœ… **Maintenance UI** - Integrated in HabitatDebug panel

**Files Modified:**
- âœ… `src/stores/habitatConditions.ts` - Added poop tracking
- âœ… `src/components/game/HabitatVisual.vue` - Poop display integration
- âœ… `src/components/game/Poop.vue` - Created

**Documentation:** [System 15: Habitat Maintenance & Hygiene](systems/phase3/system-15-habitat-maintenance-hygiene.md) | [System 15.1: Habitat Debug Plan](systems/phase3/system-15.1-habitat-debug-development-plan.md)

---

#### **System 16: Autonomy Preparation** ðŸ”œ

**Priority:** HIGH (Required for Phase 4 Autonomy)
**Status:** ðŸ“‹ Not Started
**Estimated Time:** 8-13 hours

**Goal:** Complete Phase 3 by implementing 5 critical systems required for guinea pig autonomy

**5-Phase Implementation:**

1. **Phase 1: Item Type Metadata** (1-2 hours)
   - Add `itemType` to supplies: 'water_bottle' | 'food_bowl' | 'hay_rack' | 'shelter' | 'bed' | 'toy' | 'chew'
   - Map item types to need satisfaction
   - Enable autonomy to identify item functions

2. **Phase 2: Water Consumption System** (1-2 hours)
   - Track guinea pig drinking from water bottles
   - Reduce waterLevel in habitatConditions
   - Water bottle position lookup for pathfinding

3. **Phase 3: Environmental Decay** (2-3 hours)
   - Bedding freshness gradual decay (quality-based rates)
   - Cleanliness decay from guinea pig activity
   - Time-based decay integration with game loop

4. **Phase 4: Guinea Pig Position Tracking** (2-3 hours)
   - Track guinea pig position in habitat grid
   - Initialize position when guinea pig becomes active
   - Movement updates position and records activity

5. **Phase 5: Item Usage History** (2-3 hours)
   - Track when items were last used by guinea pig
   - Effectiveness decay with overuse (encourages rotation)
   - Usage count and statistics for AI decisions

**Files to Modify:**
- `src/types/supplies.ts` - Add ItemType and NeedType
- `src/stores/suppliesStore.ts` - Add item type metadata
- `src/stores/habitatConditions.ts` - Add all 5 phases
- `src/stores/gameController.ts` - Integrate decay and recovery
- `src/stores/guineaPigStore.ts` - Initialize positions
- `src/components/game/HabitatVisual.vue` - Display positions

**Documentation:** [System 16: Autonomy Preparation](systems/phase3/system-16-autonomy-preparation.md)

---

## ðŸŽ¯ **High Priority Improvements**

### Currency Reward System ðŸ”¥
**Goal:** Implement currency earning system that rewards good guinea pig care

**Concept:** Friendship Dividends - Guinea pigs earn currency based on friendship points Ã— wellness
- Active pigs: `(friendshipPoints / 100) Ã— (wellness / 100) Ã— 20 = currency/hour`
- Sanctuary pigs: `(friendshipPoints / 100) Ã— 30 = currency/hour` (higher rate, friendship-only)
- Offline accumulation (8-hour cap to prevent FOMO)
- Bonus systems: Daily login (+100), interactions (+5 each), friendship milestones (250-2000 points)
- Self-balancing economy that scales with progression and rewards long-term bonds

**Documentation:** [Currency Reward System Design](game-design/currency-reward-system.md)

**Implementation Priority:** HIGH - Required before expanding supplies catalog

---

### Friendship System Redesign ðŸ”¥
**Goal:** Change from percentage (0-100%) to infinite point-based with levels

**Key Changes:**
- Point-based progression (not capped at 100%)
- 10+ tiered levels (Level 4 = Stardust Sanctuary unlock)
- Migration: existing friendship % Ã— 10 = starting points

**Files:** guineaPig.ts, guineaPigStore.ts, petStoreManager.ts, GuineaPigEditor.vue

---

### Port Real Food Items to Preferences ðŸ”¥
**Goal:** Replace hardcoded food arrays with Supplies Store catalog

**Implementation:**
- Pull food from `suppliesStore.getFoodByCategory()` instead of hardcoded lists
- Update preference generation to use real item IDs
- Validate guinea pig preferences against Supplies Store

**Files:** GuineaPigEditor.vue, petStoreManager.ts, guineaPigStore.ts

---

### Personality-Based Habitat Sensitivity ðŸ”¥
**Goal:** Add 5th personality trait (cleanliness 1-10) affecting habitat tolerance

**Trait Effects:**
- **Picky (7-10):** Won't eat hay <60% fresh, stressed by mess
- **Moderate (4-6):** Baseline 40% thresholds
- **Piggy (1-3):** Tolerates mess, eats hay down to 20% fresh

**Files:** guineaPig.ts, guineaPigStore.ts, habitatConditions.ts, needsController.ts, messageGenerator.ts

---

## ðŸ”§ **Technical Debt & Polish**

### Code Cleanup
- [x] Review and consolidate debug panel styles
- [x] Audit unused imports across components
- [x] Remove any remaining legacy favorites references in comments
- [x] CSS & Component Cleanup (Phase 5 complete - improved color contrast, mobile-first patterns)
- [ ] Standardize error handling patterns

### UI/UX Improvements
- [ ] Add loading states for long operations
- [ ] Improve mobile responsiveness for debug panels
- [ ] Add keyboard shortcuts for common debug actions
- [x] Enhance visual feedback for disabled buttons

### Documentation
- [x] Update architecture diagrams for Phase 2 changes
- [x] Document state management patterns
- [ ] Create component library reference
- [ ] Add inline JSDoc comments for complex functions

---

## ðŸ“ **Notes**

### Recent Changes (Phase 7 - October 13)
- Changed "Cage" terminology to "Habitat" throughout Pet Adoption UI
- Changed "Pet Store" to "Pet Adoption" in main heading
- Added InfoButton to Stardust Sanctuary with feature description
- Increased InfoButton popover width (300px default, 400px max)
- ~~Added Feeding Cycle Status panel showing hunger progress and manual reset controls~~ (removed)
- Removed disliked activities and habitats from preference system (kept food dislikes)
- Updated all affected components, stores, and message generators

### Property Name Considerations
Note: `cageNumber` property name remains in code for data compatibility, only UI labels use "habitat"

### System Integration
All Phase 2 systems are fully integrated:
- Friendship system with passive gain/loss
- Needs system with personality modifiers
- Preferences with food/activity favorites
- Consumption limits with hunger cycles
- Stardust Sanctuary with 85% threshold
- Permanent adoption with natural churn

---

## ðŸŽ® **Testing Checklist**

### Pre-Phase 3 Testing
- [ ] Test full adoption flow with observe interaction
- [ ] Verify paired guinea pigs leave store together
- [ ] Test Stardust Sanctuary unlock at 85% friendship
- [ ] Verify consumption limits reset at 100% hunger
- [ ] Test preference system (favorites, dislikes, rejection)
- [ ] Verify habitat grouping displays correctly
- [ ] Test InfoButton tooltips across all panels

### Integration Testing
- [ ] Test multiple guinea pigs with different personalities
- [ ] Verify friendship gain/loss calculations
- [ ] Test edge cases (0% friendship, 100% friendship)
- [ ] Verify adoption timer expiration and store updates
- [ ] Test manual consumption limit resets

---

## ðŸš€ **Commands**

**Development:**
- `npm run dev` - Start development server
- `npm run build` - Production build (run before commits)
- `npm run preview` - Preview production build

**Git:**
- Current branch: `GPS2-24`
- Main branch: `main`

---

## ðŸ“š **Documentation Links**

- [Project Plan](PROJECT_PLAN.md)
- [Development Phases](DEVELOPMENT_PHASES.md)
- [System Integration](SYSTEM_INTEGRATION.md)
- [Phase 2 Systems](systems/phase2/)
- [Phase 2.5 Systems](systems/phase2.5/)
- [System 6.95 Implementation](systems/phase2/system-6.95.1-implementation-plan.md)
