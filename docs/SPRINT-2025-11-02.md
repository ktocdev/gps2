# GPS2 Sprint - November 2, 2025

**Started:** November 2, 2025
**Status:** Active üöß
**Branch:** GPS2-42
**Previous Sprint:** [SPRINT-2025-10-27.md](SPRINT-2025-10-27.md)

---

## ‚úÖ **Completed Work from Previous Sprint**

The following items were completed during the November 2, 2025 session:

### Bug Fixes ‚úÖ
1. **Clear Game Data Doesn't Clear Habitat View** - FIXED
   - Fixed race condition where items persisted and guinea pigs froze after clearing storage
   - Rewrote `clearAllStorage()` to stop game loop, manually clear stores, add delay for reactivity, then reload
   - [UtilityNav.vue](../src/components/layout/UtilityNav.vue)

2. **Activity Feed Auto-Scroll** - FIXED
   - Fixed auto-scroll scrolling to bottom when newest messages are at top
   - Renamed `scrollToBottom()` to `scrollToTop()` and changed `scrollTop = scrollHeight` to `scrollTop = 0`
   - [ActivityFeed.vue](../src/components/game/ui/ActivityFeed.vue)

### Documentation ‚úÖ
3. **Sprint Organization** - COMPLETE
   - Created new sprint document with all todos organized by category and priority
   - Moved old sprint to archive
   - Updated todos.md to reference new sprint

---

## üéØ **Sprint Goals**

**Focus:** Bug fixes, UI polish, and gameplay improvements for Phase 4.5

**Priority Areas:**
1. Guinea pig interaction polish and animations
2. Inventory and resource display accuracy
3. Social bonding enhancements
4. Activity feed improvements

---

## üêõ **Bug Fixes**

### High Priority Bugs üî•

#### Hay Servings Count Display Intermittent ‚úÖ **FIXED**
**Priority:** HIGH
**Status:** ‚úÖ Complete
**Category:** Inventory & Resources

**Issue:** Hay rack servings display shows "1/1" instead of "1/4" - appears to be intermittent

**Investigation Required:**
- Check if hay rack capacity is being read correctly from supplies metadata
- Verify hay rack contents count calculation
- Check if different hay types have different capacity values
- Determine if issue is timing-related (race condition during initialization)

**Files to Check:**
- [HabitatDebug.vue](../src/components/debug/environment/HabitatDebug.vue) - Hay rack display logic
- [HayRack.vue](../src/components/game/habitat/HayRack.vue) - Capacity prop usage
- [habitatConditions.ts](../src/stores/habitatConditions.ts) - Hay rack content tracking
- [supplies/habitat/food-bowls-hay-racks.json](../src/data/supplies/habitat/food-bowls-hay-racks.json) - Capacity metadata

---

#### Inventory Sidebar Hay Count Display Wrong ‚úÖ **FIXED**
**Priority:** HIGH
**Status:** ‚úÖ Complete
**Category:** Inventory & Resources

**Issue:** Timothy hay shows "8" in inventory count but icon count looks wrong - appears to be intermittent

**Investigation Required:**
- Check if inventory sidebar is reading from correct store
- Verify timothy hay quantity calculation
- Check if different hay types affect display
- Look for race conditions in inventory updates
- Verify icon badge count matches numeric display

**Files to Check:**
- [InventorySidebar.vue](../src/components/game/habitat/sidebars/InventorySidebar.vue) - Hay display and count
- [inventoryStore.ts](../src/stores/inventoryStore.ts) - Quantity calculation
- Inventory item rendering components

---

### Medium Priority Bugs üìã

#### Clear Game Data Doesn't Clear Habitat View ‚úÖ **FIXED**
**Priority:** MEDIUM
**Status:** ‚úÖ Complete
**Category:** UI/UX

**Issue:** When clicking "Clear All Storage" from habitat debug, items persist in the visual display and guinea pigs appear frozen

**Expected Behavior:**
- Click "Clear All Storage" button
- All game state clears (guinea pigs, items, needs, etc.)
- Habitat view resets to empty state immediately
- All visual elements removed from habitat grid
- No frozen guinea pigs

**Root Cause:**
- `localStorage.clear() + window.location.reload()` race condition
- DOM not updated before reload
- Store state not explicitly cleared before localStorage wipe
- Game loop and timers not stopped before clearing

**Solution Implemented:**
- Stop game loop and timers first
- Manually clear all habitat data (items, positions, poops, guinea pigs)
- Clear all guinea pigs using `deleteGuineaPig()`
- Add 100ms delay for Vue reactivity to update UI
- Then clear localStorage and reload

**Files Modified:**
- [UtilityNav.vue](../src/components/layout/UtilityNav.vue) - Complete rewrite of `clearAllStorage()` function

---

#### Simultaneous Pooping Bug ‚è∏Ô∏è **DEFERRED**
**Priority:** MEDIUM (deferred to future sprint)
**Status:** ‚è∏Ô∏è Deferred
**Category:** Gameplay

**Issue:** Multiple guinea pigs poop too close together in time - staggered but not sufficiently randomized

**Note:** Deferring to future sprint as issue is not as noticeable currently. Will revisit when doing broader gameplay balance pass.

**Previous Attempts:**
- Random offset to initial timestamps (0-30 seconds)
- Random jitter to decision timing (0-2 seconds)
- Wider goal selection randomization (15 priority points)
- Random need decay timing offsets
- Per-poop randomization (0-10 second backwards offset)

**Next Steps (when resuming):**
- Increase random offset range (0-20 seconds instead of 0-10)
- Consider truly random intervals (15-45 seconds) instead of fixed 30s base
- Test with 3+ guinea pigs over extended time

---

### Low Priority Bugs üîß

#### Activity Feed Auto-Scroll to Bottom ‚úÖ **FIXED**
**Priority:** LOW
**Status:** ‚úÖ Complete
**Category:** Activity Feed

**Issue:** Activity log was scrolling to bottom when adding new activity, but messages are displayed in reverse order (newest at top)

**Root Cause:**
- Messages displayed in reverse order via `.reverse()` - newest messages appear at TOP of feed
- `scrollToBottom()` function scrolled to BOTTOM of container
- This caused scroll to go to oldest messages instead of newest
- Auto-scroll was working backwards from message display order

**Solution Implemented:**
- Renamed `scrollToBottom()` to `scrollToTop()`
- Changed scroll behavior: `scrollTop = 0` instead of `scrollTop = scrollHeight`
- Now scrolls to top of container where newest messages appear
- Updated comments to clarify behavior
- Auto-scroll now correctly shows newest messages when they arrive

**Files Modified:**
- [ActivityFeed.vue](../src/components/game/ui/ActivityFeed.vue) - Fixed auto-scroll direction to match message order

---

## ‚ú® **Feature Enhancements**

### Guinea Pig Interactions üêπ

#### Guinea Pig Wiggle When Chewing üìã **NOT STARTED**
**Priority:** MEDIUM
**Status:** üìã Not Started
**Category:** Animations & Polish

**Goal:** Add wiggle animation when guinea pig chews on chew toy

**Current Behavior:**
- Guinea pig chews chew toy
- No visual animation during chewing
- Static sprite while chewing

**Desired Behavior:**
- Guinea pig sprite wiggles/shakes slightly while chewing
- Animation matches chewing behavior duration
- Visual feedback that guinea pig is actively chewing

**Implementation:**
- Add `wiggle` CSS animation class
- Apply during chew behavior (similar to existing play animation)
- Ensure animation pauses when game is paused
- Use same animation pattern as play/wiggling behavior

**Files to Modify:**
- [GuineaPigSprite.vue](../src/components/game/habitat/GuineaPigSprite.vue) - Add chewing animation class binding
- [useGuineaPigBehavior.ts](../src/composables/game/useGuineaPigBehavior.ts) - Set animation state during chew

**Related:** This uses the same wiggle animation as play behavior, just needs to be triggered during chew

---

#### Guinea Pig Wiggle During Player Interaction üìã **NOT STARTED**
**Priority:** MEDIUM
**Status:** üìã Not Started
**Category:** Animations & Polish

**Goal:** Guinea pig should wiggle when user interacts with them (socialize actions)

**Current Behavior:**
- User clicks socialize button (pet, hold, hand-feed, etc.)
- Guinea pig receives interaction benefits
- No visual animation during interaction

**Desired Behavior:**
- Guinea pig wiggles when being petted/held/interacted with
- Animation plays during interaction duration
- Visual feedback that interaction is happening

**Implementation:**
- Add wiggle animation to manual socialize interactions
- Apply to all socialize action types (pet, hold, hand-feed, talk-to, etc.)
- Use existing wiggle CSS animation
- Ensure animation stops when interaction completes

**Files to Modify:**
- [useGuineaPigBehavior.ts](../src/composables/game/useGuineaPigBehavior.ts) - Add animation state to manual socialize
- [GuineaPigSprite.vue](../src/components/game/habitat/GuineaPigSprite.vue) - Verify wiggle animation is reusable

**Testing:**
- Click socialize actions on guinea pig
- Verify wiggle animation plays
- Verify animation stops after interaction

---

### Social Bonding Enhancements ü§ù

#### Sleeping Together Bonding Bonus üìã **NOT STARTED**
**Priority:** MEDIUM
**Status:** üìã Not Started
**Category:** Social Bonding

**Goal:** Guinea pig bonding should increase when two guinea pigs sleep in the same shelter together

**Current Behavior:**
- Two guinea pigs can sleep in same shelter
- Sprites stack on top of each other (see bug below)
- No bonding benefit for sleeping together

**Desired Behavior:**
- When two bonded/pairing guinea pigs sleep in same shelter, increase bond level
- Small bonding increase per sleep session (e.g., +1-2 bond points)
- Activity feed message: "[GP1] and [GP2] cuddle together in the [shelter name]"
- Bonding increase only happens once per sleep session (not continuously)

**Implementation Requirements:**
1. Detect when two guinea pigs are in same shelter position
2. Check if both are sleeping
3. Apply bonding increase to the pair
4. Generate appropriate activity message
5. Prevent duplicate bonding increases for same sleep session

**Files to Modify:**
- [useGuineaPigBehavior.ts](../src/composables/game/useGuineaPigBehavior.ts) - Sleep behavior detection and bonding logic
- [guineaPigStore.ts](../src/stores/guineaPigStore.ts) - Bonding adjustment function (already exists)
- [messageGenerator.ts](../src/utils/messageGenerator.ts) - New message for shared sleeping

**Related Bug:** Fix guinea pig sprite stacking before implementing this feature

---

### UI/UX Improvements üé®

#### Guinea Pigs in Same Shelter Shouldn't Stack ‚úÖ **FIXED**
**Priority:** HIGH
**Status:** ‚úÖ Complete
**Category:** Visual Display

**Issue:** When two guinea pigs are in a shelter, their sprites render on top of each other - we only see one guinea pig

**Current Behavior:**
- Both guinea pigs occupy exact same grid cell
- Sprites stack vertically with z-index
- Only top sprite is visible

**Desired Behavior:**
- Guinea pigs in same shelter should be slightly offset
- Both sprites should be visible
- Natural "cuddling" appearance
- Offset should be small enough to keep them in shelter visual area

**Implementation Options:**

**Option 1: Sub-cell Positioning (Recommended)**
- When guinea pig enters shelter, check if another guinea pig is already there
- Apply small pixel offset to second guinea pig (e.g., 5-10px in x/y direction)
- Store offset in guinea pig position data
- Reset offset when leaving shelter

**Option 2: Z-index + Transform**
- Use CSS transform to slightly shift second guinea pig
- Maintain same grid position but visual offset
- Less data management, more CSS-based

**Files to Modify:**
- [GuineaPigSprite.vue](../src/components/game/habitat/GuineaPigSprite.vue) - Add position offset rendering
- [habitatConditions.ts](../src/stores/habitatConditions.ts) - Store sub-cell offset in position data
- [useGuineaPigBehavior.ts](../src/composables/game/useGuineaPigBehavior.ts) - Apply offset when entering occupied shelter

**Testing:**
- Two guinea pigs sleep in same shelter
- Verify both sprites are visible
- Verify sprites return to normal positioning when leaving shelter

---

## üìä **Resource & Documentation**

### Food Serving Guide üìã **NOT STARTED**
**Priority:** MEDIUM
**Status:** üìã Not Started
**Category:** Documentation & UX

**Goal:** Create visual food serving guide in addition to feeding limits imposed by game

**Current System:**
- Game enforces 5 serving limit per hunger cycle (excluding hay)
- Serving amounts vary by food type
- No in-game reference for serving sizes or daily limits

**Desired Features:**

**1. Food Serving Reference Card:**
- Visual guide showing serving sizes for each food type
- Daily recommended amounts per guinea pig
- Fruit vs vegetable balance recommendations
- Hay unlimited reminder
- Pellets daily serving size

**2. Integration Points:**
- Add info button in InventorySidebar near food category
- Tooltip/popover showing serving guide
- Optional: In-game "Guinea Pig Care Guide" section

**3. Content Format:**
- **Vegetables:** "Feed 1 cup daily (4-6 servings)"
- **Fruits:** "Feed sparingly as treats (1-2 servings daily)"
- **Pellets:** "Feed 1/8 cup daily (2-3 servings)"
- **Hay:** "Unlimited - always available"

**Files to Create:**
- Component for food serving guide display (modal or popover)
- Markdown documentation for reference

**Files to Modify:**
- [InventorySidebar.vue](../src/components/game/habitat/sidebars/InventorySidebar.vue) - Add info button to food section

**Note:** This complements the existing feeding limits system and provides educational value to players

---

## üéØ **Future Enhancements (From Previous Sprint)**

These items are carried over from the October 27, 2025 sprint for future consideration:

### Social Interaction Enhancements ü§ù

#### Multi-Type Guinea Pig Interactions üìã **LOW PRIORITY**
**Priority:** LOW
**Status:** üìã Not Started (Future Enhancement)
**Category:** Social Bonding - Phase 5+

**Goal:** Expand guinea pig social interactions beyond just "socialize"

**Current System:**
- Guinea pigs have single "socialize" interaction
- Only increases social need
- No variety in interaction types

**Proposed Interaction Types:**

1. **Play Interaction** (guinea pig to guinea pig)
   - Increases both social AND play needs
   - Example: Two guinea pigs chase each other, popcorn together
   - More energetic, requires both guinea pigs to be active
   - **Note:** User-to-guinea pig play should also increase play need

2. **Sniff/Investigate**
   - Increases social need only
   - Example: Guinea pigs sniff each other, investigate
   - Passive interaction, greeting behavior

3. **Groom (Allogrooming)**
   - Increases social AND hygiene needs
   - Example: One guinea pig grooms another
   - Bonding behavior that also provides hygiene benefit
   - More common in bonded pairs

4. **Huddle/Cuddle**
   - Increases social and comfort needs
   - Example: Guinea pigs snuggle together
   - Resting behavior, often during sleep

**Implementation Requirements:**
- Expand social interaction system beyond single "socialize" behavior
- Add interaction type selection based on context (energy levels, bond level)
- Update message generation for different interaction types
- Adjust need satisfaction based on interaction type
- Consider bond level affecting interaction availability

**Files to Modify:**
- [useGuineaPigBehavior.ts](../src/composables/game/useGuineaPigBehavior.ts) - Expand social interaction logic
- [messageGenerator.ts](../src/utils/messageGenerator.ts) - Add new interaction messages
- [guineaPigStore.ts](../src/stores/guineaPigStore.ts) - May need interaction type tracking

**Note:** This is a Phase 5+ enhancement, not critical for Phase 4.5

---

#### Pushable Toys System üìã **LOW PRIORITY**
**Priority:** LOW
**Status:** üìã Not Started (Future Enhancement)
**Category:** Gameplay - Phase 5+

**Goal:** Guinea pigs physically move balls and pushable toys across grid cells

**Current Behavior:**
- Guinea pig plays with ball in place
- Ball doesn't move
- Message: "plays with a toy"

**Desired Behavior:**
- Guinea pig pushes ball across 1-3 grid cells
- Ball position updates in real-time
- Message: "pushes the ball across the habitat"
- Visual animation of ball moving

**Implementation Requirements:**
1. Add `pushable: boolean` metadata to toy items
2. Track toy positions in habitatConditions (similar to guinea pig positions)
3. Update play behavior to move pushable toys
4. Add visual animation for toy movement
5. Update toy rendering to use dynamic position

**Files to Modify:**
- [supplies/habitat/toys.json](../src/data/supplies/habitat/toys.json) - Add pushable flag
- [habitatConditions.ts](../src/stores/habitatConditions.ts) - Track toy positions
- [useGuineaPigBehavior.ts](../src/composables/game/useGuineaPigBehavior.ts) - Play behavior with push logic
- Toy rendering components - Use dynamic positioning

**Note:** This is a nice-to-have feature, not critical for Phase 4.5 completion

---

### Adoption System Enhancement üêπ

#### Pre-Bonded Pairs & Solo Guinea Pigs üìã **PLANNED**
**Priority:** HIGH (Future Sprint)
**Status:** üìã Not Started
**Category:** Pet Store & Adoption

**Goal:** Implement adoption constraints for bonded pairs and solo-suitable guinea pigs with enhanced observation system

**Core Rules:**
1. **Bonded Pairs Must Be Adopted Together**
   - Guinea pigs with existing bonds in the pet store must be adopted as a pair
   - User cannot adopt just one of a bonded pair
   - Adoption will be denied until user selects both bonded guinea pigs
   - Error message: "These guinea pigs are bonded and must be adopted together"

2. **Solo Guinea Pig Rules**
   - Some guinea pigs are suited to be solo (marked as `suitableForSolo: true`)
   - Solo-suitable guinea pigs were found as solo rescues (backstory)
   - Non-solo guinea pigs CANNOT be adopted alone
   - User must either adopt a pair or adopt a solo-suitable guinea pig
   - Error message: "This guinea pig needs a companion. Select another guinea pig or choose one suited for solo living"

3. **Adoption Combinations Allowed:**
   - ‚úÖ Bonded pair (both guinea pigs)
   - ‚úÖ Two unbonded guinea pigs (any combination)
   - ‚úÖ One solo-suitable guinea pig
   - ‚ùå One guinea pig from bonded pair
   - ‚ùå One non-solo-suitable guinea pig alone

**Enhanced Observation System:**

**3 Observation Clues per Guinea Pig:**
1. **Social/Bonding Clue** (NEW)
   - Reveals bonding information or solo suitability
   - Examples for bonded pairs: "Seems very attached to [other guinea pig name]", "Always stays close to [other guinea pig name]"
   - Examples for solo-suitable: "Prefers their own space", "Was found living alone and seems content that way"
   - Examples for social but unbonded: "Friendly and would enjoy a companion", "Curious about other guinea pigs"

2. **Personality Clue** (existing)
   - Reveals one personality trait
   - Examples: "Very playful", "Cautious and careful", "Bold explorer"

3. **Preference Clue** (existing)
   - Reveals one food preference
   - Examples: "Seems to enjoy carrots", "Not interested in apples"

**Implementation Tasks:**
- [ ] Add `bondedWith: string | null` field to GuineaPig type
- [ ] Add `suitableForSolo: boolean` field to GuineaPig type
- [ ] Update pet store generation to create bonded pairs (~20% of guinea pigs)
- [ ] Update pet store generation to mark some as solo-suitable (~10%)
- [ ] Add adoption validation logic in petStoreManager
- [ ] Add error messaging for invalid adoption attempts
- [ ] Expand observation system from 2 to 3 clues
- [ ] Add social/bonding clue generation logic
- [ ] Update habitat placement validation to enforce bonded pair rules
- [ ] Add UI indicators for bonded pairs in pet store
- [ ] Update guinea pig cards to show bonding status

**Files to Modify:**
- [guineaPigStore.ts](../src/stores/guineaPigStore.ts) - Add bondedWith and suitableForSolo fields
- [petStoreManager.ts](../src/stores/petStoreManager.ts) - Generation logic and adoption validation
- [observationGenerator.ts](../src/utils/observationGenerator.ts) - Expand to 3 clues
- [GuineaPigCard.vue](../src/components/game/petstore/GuineaPigCard.vue) - Display bonding status
- [PetStoreView.vue](../src/views/PetStoreView.vue) - Adoption validation
- [GuineaPigsView.vue](../src/views/GuineaPigsView.vue) - Habitat placement validation

---

### Testing & Balance üéÆ

#### Gameplay Testing Checklist üìã **PLANNED**
**Priority:** HIGH (Future Sprint)
**Status:** üìã Not Started

**Testing Areas:**

**1. Needs & Wellness System**
- [ ] All 11 needs decay at correct rates
- [ ] Wellness calculation reflects actual need state
- [ ] Personality traits affect decay as documented
- [ ] Habitat conditions affect needs appropriately
- [ ] Need thresholds trigger correct autonomous behaviors

**2. Autonomous Behaviors**
- [ ] All 12 behavior types execute correctly
- [ ] Pathfinding handles all habitat layouts
- [ ] Guinea pigs don't get stuck on items
- [ ] Behavior priorities make sense
- [ ] Personality affects behavior frequency

**3. Food & Consumption**
- [ ] New serving amounts work correctly
- [ ] Food consumption limits enforce properly
- [ ] Food freshness decays at reasonable rate
- [ ] Guinea pigs prefer liked foods
- [ ] Guinea pigs avoid disliked foods

**4. Habitat Conditions**
- [ ] Cleanliness decays at reasonable rate
- [ ] Bedding freshness affects comfort
- [ ] Water level consumption matches drinking
- [ ] Hay freshness per-rack works correctly
- [ ] Poop accumulation affects cleanliness

**5. Social Bonding**
- [ ] Bond levels increase with interactions
- [ ] Bond levels persist across sessions
- [ ] Bond levels affect social need satisfaction
- [ ] Multiple guinea pig pairs track independently

**6. Item Metadata & Realism**
- [ ] All item types have correct metadata
- [ ] Chew durability degrades at reasonable rates
- [ ] Hideaway/shelter items provide security
- [ ] Toys increase play satisfaction
- [ ] Food bowls and hay racks function correctly

---

#### Create Realism Guidelines üìã **PLANNED**
**Priority:** MEDIUM (Future Sprint)
**Status:** üìã Not Started

**Goal:** Document realistic guinea pig care guidelines for game balance

**Topics to Cover:**
1. **Feeding Frequency & Amounts**
   - How often should guinea pigs need food/water?
   - What's a realistic hunger cycle duration?
   - Hay should be unlimited - guinea pigs graze constantly

2. **Sleep Patterns**
   - Guinea pigs sleep in short bursts (5-10 minutes)
   - 4-6 hours total sleep per day
   - More active at dawn/dusk (crepuscular)

3. **Social Behavior**
   - Guinea pigs are highly social - need companionship
   - Bonding takes weeks/months in real life
   - Play behaviors: popcorning, zoomies, following, grooming

4. **Hygiene & Maintenance**
   - Self-grooming is frequent (multiple times per day)
   - Nails grow slowly (~monthly trimming in real life)
   - Poop frequently (100+ times per day!)
   - Clean habitat reduces stress

5. **Habitat Preferences**
   - Need hiding places for security
   - Enjoy tunnels and exploration
   - Sensitive to cleanliness (varies by personality)
   - Temperature and noise sensitivity

**Output:** Create [game-design/guinea-pig-realism-guide.md](../docs/game-design/guinea-pig-realism-guide.md)

---

## üìù **Sprint Completion Criteria**

**Completed This Session (November 2, 2025):**
- [x] Clear Game Data bug fixed (items and guinea pigs clear properly)
- [x] Activity feed auto-scroll fixed (now scrolls to newest messages at top)
- [x] Sprint documentation organized and archived

**Must Complete (Next Session):**
- [ ] Hay servings count display fixed (shows 1/1 instead of 1/4)
- [ ] Inventory sidebar hay count fixed (intermittent display issue)
- [ ] Guinea pig wiggle animations implemented (chewing + interactions)
- [ ] Guinea pigs in same shelter don't stack visually

**Should Complete:**
- [ ] Sleeping together bonding bonus implemented
- [ ] Food serving guide created

**Nice to Have:**
- [ ] Testing with 3+ guinea pigs
- [ ] Extended gameplay testing (30+ minutes)
- [ ] All features documented

---

## üöÄ **Commands**

**Development:**
- `npm run dev` - Start development server
- `npm run build` - Production build (run before commits)
- `npm run preview` - Preview production build

**Git:**
- Current branch: `GPS2-42`
- Main branch: `main`

---

## üìö **Documentation Links**

- [Project Plan](PROJECT_PLAN.md)
- [Development Phases](DEVELOPMENT_PHASES.md)
- [System Integration](SYSTEM_INTEGRATION.md)
- [Previous Sprint - October 27, 2025](SPRINT-2025-10-27.md)
